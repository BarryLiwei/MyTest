webpackJsonp([21],{"09Iu":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("woOf"),a=i.n(s),o=i("Dd8w"),l=i.n(o),r=i("NYxO"),n=(i("bg5R"),i("/Uby")),c=i("IaGi"),d=i("ufHF"),u=i("RbfQ"),p=i("CKy9"),h=i("Ljuz"),f=i("gNHg"),g=i("PdD4"),b=i("MsbF"),m=i("K9jU"),v=i("jbi9"),C={components:{SearchBar:n.a,SearchCol:c.a,DataTable:d.a,ExportLog:u.a,CommonExport:p.a,CascaderScrm:h.a,AddCluesDialog:f.a,Distribute:b.a,Actived:m.a,ShowResult:v.a},mixins:[g.a],data:function(){return{showAddClues:!1,showDistribute:!1,showActived:!1,showResultTip:!1,dialogLoading:!1}},created:function(){this.initData(),this.queryData()},computed:l()({},Object(r.b)(["roleKey"])),methods:{initData:function(){this.resultConfig={},this.getBrandList(),this.getClueFrom(),this.getDccList(),this.getClueStatusList(),this.getClueTypeList(),this.getAreaOptions("area"),this.initSearch(),this.initTable(),this.initExport()},initExport:function(){this.exportConfig={fileName:"线索导出",ext:"csv",idName:"id",select:[],taskType:"",url:"business.exportClueExcel",other:{}},this.logConfig={listUrl:"business.exportClueLog",downUrl:"business.exportClueExcel"}},initSearch:function(){var t=this.$route&&this.$route.query;this.search={list:[{prop:"dccGroup",type:"select",label:"处理坐席组",currentVal:"",selectOptions:[],optionLabel:"dccGroupName",optionValue:"id"},{prop:"dcc",type:"select",label:"处理DCC",currentVal:"",isAll:!0,isAllTitle:"全部",selectOptions:[],optionLabel:"dccName",optionValue:"id"},{prop:"grade",type:"select",label:"线索评分",currentVal:"",isAll:!0,isAllTitle:"全部",selectOptions:[{title:"1分",value:1},{title:"2分",value:2},{title:"3分",value:3},{title:"4分",value:4},{title:"5分",value:5}],optionLabel:"title",optionValue:"value"},{prop:"customer",type:"cascader",label:"客户来源",currentVal:"",oneVal:"",oneOptions:[],oneOptionLabel:"title",oneOptionValue:"id",secondVal:"",isAll:!0,isAllTitle:"全部",secondOptions:[],secondOptionLabel:"title",secondOptionValue:"id"},{prop:"brand",type:"select",label:"意向品牌",currentVal:"",selectOptions:[],optionLabel:"title",optionValue:"id"},{prop:"series",type:"select",label:"意向车系",currentVal:"",selectOptions:[],optionLabel:"title",optionValue:"id"},{prop:"model",type:"select",label:"意向车型",currentVal:"",isAll:!0,isAllTitle:"全部",selectOptions:[],optionLabel:"title",optionValue:"id"},{prop:"area",type:"select",label:"归属门店",currentVal:"",isAll:!0,isAllTitle:"全部",selectOptions:[],optionLabel:"title",optionValue:"id"},{prop:"state",type:"select",label:"线索类型",currentVal:"",isAll:!0,isAllTitle:"全部",selectOptions:[],optionLabel:"title",optionValue:"id"},{prop:"state",type:"select",label:"线索状态",currentVal:parseInt(t.state)||"",isAll:!0,isAllTitle:"全部",selectOptions:[],optionLabel:"title",optionValue:"id"},{prop:"time",type:"datePicker",label:"线索获取时间",currentVal:""},{prop:"keyword",type:"input",label:"关键字搜索",currentVal:""}],dccGroup:0,dcc:1,grade:2,customer:3,brand:4,series:5,model:6,area:7,type:8,state:9,time:10,keyword:11},this.$store.state.business.clue&&this.$store.state.business.clue.search&&(this.search.list=this.$store.state.business.clue.search)},initTable:function(){var t=this;this.dataTable={tr:[{id:"1",label:"操作选项",prop:"caozuo",show:"template",minWidth:"260"},{id:"2",label:"线索姓名",prop:"nickname",tooltip:!0,minWidth:"100"},{id:"3",label:"手机号码",prop:"tel",tooltip:!0,minWidth:"120"},{id:"4",label:"处理坐席组",prop:"dccGroupName",minWidth:"120"},{id:"5",label:"处理DCC",prop:"dccName",minWidth:"120"},{id:"6",label:"线索评分",prop:"grade",show:"template",minWidth:"100"},{id:"7",label:"客户来源",prop:"from",show:"template",tooltip:!0,minWidth:"150"},{id:"8",label:"意向品牌",prop:"brand",tooltip:!0,minWidth:"120"},{id:"9",label:"意向车系",prop:"carSeries",tooltip:!0,minWidth:"120"},{id:"10",label:"意向车型",prop:"model",tooltip:!0,minWidth:"250"},{id:"11",label:"归属门店",prop:"areaName",tooltip:!0,minWidth:"120"},{id:"12",label:"线索类型",prop:"clueTypeName",tooltip:!0,minWidth:"100"},{id:"13",label:"线索状态",prop:"statusName",tooltip:!0,minWidth:"110"},{id:"14",label:"线索获取时间",prop:"createdAt",tooltip:!0,minWidth:"170"},{id:"15",label:"处理时长",prop:"handleTime",tooltip:!0,minWidth:"110"}],data:[],page:{totalCount:0,pageSize:20,currentPage:1},hasSelect:!0,hasExpand:!1,hasFirstPagination:!0,showScrollBar:!0,search:{value:"",show:!0,url:"business.queryClueList",width:"220",placeholder:"线索姓名/手机号码",displayCol:["nickname","tel"],params:{id:""}}},this.$store.state.business.clue&&this.$store.state.business.clue.page&&(this.dataTable.page=this.$store.state.business.clue.page,this.$nextTick(function(){t.$refs.DataTableRef.currentPage=t.dataTable.page.currentPage}))},getParams:function(){var t=this.dataTable.page,e=t.currentPage,i=t.pageSize,s=this.search,a=s.grade,o=s.customer,l=s.brand,r=s.series,n=s.model,c=s.area,d=s.state,u=s.type,p=s.time,h=s.dcc,f=s.dccGroup,g=s.list,b=s.keyword;return{dccGroupId:g[f].currentVal,dccId:g[h].currentVal,grade:g[a].currentVal,fromTopId:g[o].oneVal,fromSecondId:g[o].secondVal,brandId:g[l].currentVal,carSeriesId:g[r].currentVal,modelId:g[n].currentVal,areaId:g[c].currentVal,clueType:g[u].currentVal,status:g[d].currentVal,createdAtStartTime:g[p].currentVal&&g[p].currentVal[0]+" 00:00:00",createdAtEndTime:g[p].currentVal&&g[p].currentVal[1]+" 23:59:59",pageSize:i,page:e,keyword:g[b].currentVal}},queryData:function(){var t=this,e=this,i=this.getParams();this.exportConfig.other=a()({},i),this.$fetch.business.queryClueList(i).then(function(i){t.$handleResponse(i,function(t){e.dataTable.data=t.list?t.list:[],e.dataTable.page=t.page?t.page:e.dataTable.page},!0)}).catch(function(){t.$store.commit("closeLoading")})},seeDetail:function(t){var e={type:"clue",search:this.search.list,page:this.dataTable.page};this.$store.commit("setBusinessStore",e),this.$router.push({path:"/business/clue/detail",query:{id:t.id}})},handleClue:function(t){this.$router.push({path:"/work/cluesDeal",query:{id:t.id,userId:t.userId}})},addClue:function(){this.showAddClues=!0,this.dccConfig={show:!0,groupOptions:this.$deepCopyContent(this.search.list[this.search.dccGroup].selectOptions),groupObj:this.dccGroupObj},this.dccConfig.groupOptions&&0===this.dccConfig.groupOptions[0].id&&this.dccConfig.groupOptions.shift()},addClueSuccess:function(){this.showAddClues=!1,this.queryData()},distributeFn:function(t,e){var i=this;if(this.disConfig={title:"分配",groupLabel:"处理坐席组",groupOptions:[],groupObj:{},dccLabel:"处理DCC",selectId:[e.id],tip:""},"batch"==t){if(!this.selectData||!this.selectData.length)return void this.$message.error("请选择线索");for(var s=[],a=0,o=this.selectData.length;a<o;a++)if(s.push(this.selectData[a].id),4==this.selectData[a].status)return void this.$message.error("线索姓名为："+this.selectData[a].nickname+" 的线索状态为"+this.selectData[a].statusName+", 不能分配(无效、跟进中、已建档的线索才能分配)");this.disConfig.title="批量分配",this.disConfig.selectId=s}this.$fetch.business.assignDCCList({ids:this.disConfig.selectId,operate:"assign"}).then(function(t){i.$handleResponse(t,function(t){i.disConfig.listTotal=t.listTotal,1==t.listTotal?(i.disConfig.groupOptions=i.$hasArrContent(t.list)?t.list:[],i.showDistribute=!0,i.dialogLoading=!1):t.listTotal>1?i.$message.error("所选线索分别归属多个组，不能被分配"):i.$notify.error({title:"错误提示",message:"当前线索不符合要求"})},!1),i.$store.commit("closeLoading")}).catch(function(){i.$store.commit("closeLoading")})},closeDistribute:function(t,e){var i=this;if("cancel"==t)return this.showDistribute=!1,void(this.dialogLoading=!1);var s=a()({ids:this.disConfig.selectId},e);this.dialogLoading=!0,this.$fetch.business.clueAssign(s).then(function(t){i.$handleResponse(t,function(t){i.showDistribute=!1,i.queryData(),"批量分配"==i.disConfig.title?i.$nextTick(function(){i.setShowResult(i.disConfig.selectId.length,t)}):i.$message.success("分配成功")},!1),i.dialogLoading=!1}).catch(function(){i.dialogLoading=!1,i.$store.commit("closeLoading")})},handleActive:function(t,e){var i=this;if(this.actConfig={title:"激活",groupLabel:"处理坐席组",groupOptions:[],groupObj:{},dccLabel:"处理DCC",selectId:[e.id],tip:"线索激活状态变为“待处理”由所选坐席组及对应人员进行跟进处理"},"batch"==t){if(!this.selectData||!this.selectData.length)return void this.$message.error("请选择线索");for(var s=[],a=0,o=this.selectData.length;a<o;a++)if(s.push(this.selectData[a].id),2!=this.selectData[a].status)return void this.$message.error("线索姓名为："+this.selectData[a].nickname+" 的线索状态为"+this.selectData[a].statusName+", 不能激活(无效的线索才能激活,您可通过线索状态进行线索筛选)");this.actConfig.title="批量激活",this.actConfig.selectId=s}this.$fetch.business.assignDCCList({ids:this.actConfig.selectId,operate:"invalidActive"}).then(function(t){i.$handleResponse(t,function(t){i.actConfig.listTotal=t.listTotal,1==t.listTotal?(i.actConfig.groupOptions=i.$hasArrContent(t.list)?t.list:[],i.showActived=!0,i.dialogLoading=!1,i.actConfig.tip="线索激活状态变为“待处理”由所选坐席组及对应人员进行跟进处理"):t.listTotal>1?(i.showActived=!0,i.dialogLoading=!1,i.actConfig.groupOptions=[],i.actConfig.tip="您所选中的线索分别归属多个组，批量激活后由原处理的DCC继续处理"):i.$notify.error({title:"错误提示",message:"当前线索不符合要求"})},!0)}).catch(function(){i.$store.commit("closeLoading")})},closeActived:function(t,e){var i=this;if("cancel"==t)return this.showActived=!1,void(this.dialogLoading=!1);var s=a()({ids:this.actConfig.selectId},e);this.dialogLoading=!0,this.$fetch.business.InvalidActive(s).then(function(t){i.$handleResponse(t,function(t){i.showActived=!1,i.queryData(),"批量激活"==i.actConfig.title?i.$nextTick(function(){i.setShowResult(i.actConfig.selectId.length,t)}):i.$message.success("激活成功")},!0),i.dialogLoading=!1}).catch(function(){i.dialogLoading=!1,i.$store.commit("closeLoading")})},setShowResult:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments[1];this.resultConfig={total:t,success:e&&e.success&&e.success.length,fail:e&&e.fail&&e.fail.length,tip:""},this.showResultTip=!0}}},_={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"clue-list-page m-20 common-box"},[i("search-bar",{staticClass:"m-t-10 p-20",attrs:{size:"small"},on:{clear:t.clear,find:t.find}},[i("div",{staticClass:"search-flex"},[["dcc_supervisor","dcc_group_leader","dcc_inviter"].indexOf(t.roleKey)>-1?i("search-col",{attrs:{info:t.search.list[t.search.dccGroup],leftCol:8,filterable:""},on:{change:t.changeDccGroup}}):t._e(),t._v(" "),["dcc_supervisor","dcc_group_leader","dcc_inviter"].indexOf(t.roleKey)>-1?i("search-col",{attrs:{info:t.search.list[t.search.dcc],leftCol:8,filterable:""}}):t._e(),t._v(" "),i("search-col",{attrs:{info:t.search.list[t.search.grade],leftCol:8}}),t._v(" "),i("search-col",{attrs:{info:t.search.list[t.search.customer],leftCol:8,size:"small"},on:{fristChange:t.changeFrom}}),t._v(" "),i("search-col",{attrs:{info:t.search.list[t.search.keyword],leftCol:8,placeholder:"搜索",size:"small"}}),t._v(" "),i("search-col",{attrs:{info:t.search.list[t.search.brand],leftCol:8},on:{change:t.changeBrand}}),t._v(" "),i("search-col",{attrs:{info:t.search.list[t.search.series],leftCol:8},on:{change:t.changeSeries}}),t._v(" "),i("search-col",{attrs:{info:t.search.list[t.search.model],leftCol:8}}),t._v(" "),i("search-col",{attrs:{info:t.search.list[t.search.area],leftCol:8,filterable:""}}),t._v(" "),i("search-col",{attrs:{info:t.search.list[t.search.type],leftCol:8}}),t._v(" "),i("search-col",{attrs:{info:t.search.list[t.search.state],leftCol:8}}),t._v(" "),i("search-col",{attrs:{info:t.search.list[t.search.time],leftCol:8,type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"}})],1)]),t._v(" "),i("div",{staticClass:"p-l-r-20 p-b-20"},[i("data-table",{ref:"DataTableRef",attrs:{table:t.dataTable},on:{searchTable:t.searchTable,onHandleSelectionChange:t.handleSelectionChange},scopedSlots:t._u([{key:"caozuo",fn:function(e){return[i("div",{staticClass:"table-opertor"},[i("el-button",{staticClass:"blue_font_white_bg ",attrs:{plain:"",round:"",size:"mini"},on:{click:function(i){return t.seeDetail(e.obj.row)}}},[t._v("查看")]),t._v(" "),i("el-button",{staticClass:"blue_font_white_bg",attrs:{plain:"",round:"",size:"mini",disabled:1!=e.obj.row.status||"dcc_inviter"!=t.roleKey},on:{click:function(i){return t.handleClue(e.obj.row)}}},[t._v("处理")]),t._v(" "),i("el-button",{staticClass:"blue_font_white_bg",attrs:{plain:"",round:"",size:"mini",disabled:4==e.obj.row.status||-1==["dcc_supervisor","dcc_group_leader","administrator"].indexOf(t.roleKey)},on:{click:function(i){return t.distributeFn("one",e.obj.row)}}},[t._v("分配")])],1)]}},{key:"grade",fn:function(e){return[11!=e.obj.row.grade?i("span",[t._v(" "+t._s(t._f("filterBlank")(e.obj.row.grade))+"分")]):t._e(),t._v(" "),11==e.obj.row.grade?i("span",[t._v("--")]):t._e()]}},{key:"from",fn:function(e){return[e.obj.row.fromTopName?i("span",[t._v(t._s(e.obj.row.fromTopName)+" ")]):t._e(),t._v(" "),e.obj.row.fromTopName&&e.obj.row.fromSecondName?i("span",[t._v("--")]):t._e(),t._v(" "),e.obj.row.fromSecondName?i("span",[t._v(t._s(e.obj.row.fromSecondName)+" ")]):t._e(),t._v(" "),e.obj.row.fromTopName||e.obj.row.fromSecondName?t._e():i("span",[t._v("--")])]}}])},[i("div",{attrs:{slot:"buttons"},slot:"buttons"},[i("el-button",{staticClass:"w-60",attrs:{type:"primary",round:"",size:"small",disabled:-1==["dcc_supervisor","dcc_group_leader","dcc_inviter","administrator"].indexOf(t.roleKey)},on:{click:t.addClue}},[t._v("新增")]),t._v(" "),i("el-button",{staticClass:"w-60",attrs:{type:"primary",round:"",size:"small",disabled:-1==["dcc_supervisor","dcc_group_leader","administrator"].indexOf(t.roleKey)},on:{click:function(e){return t.distributeFn("batch",{})}}},[t._v("分配")])],1)])],1),t._v(" "),t.showAddClues?i("add-clues-dialog",{attrs:{dccConfig:t.dccConfig},on:{cluesSuccessFn:t.addClueSuccess,cluesCloseFn:function(e){t.showAddClues=!1}}}):t._e(),t._v(" "),t.showDistribute?i("distribute",{attrs:{config:t.disConfig,loading:t.dialogLoading},on:{close:t.closeDistribute}}):t._e(),t._v(" "),t.showActived?i("actived",{attrs:{config:t.actConfig,loading:t.dialogLoading},on:{close:t.closeActived}}):t._e(),t._v(" "),t.showResultTip?i("show-result",{attrs:{config:t.resultConfig},on:{close:function(e){t.showResultTip=!1}}}):t._e()],1)},staticRenderFns:[]};var w=i("VU/8")(C,_,!1,function(t){i("q4Ms")},"data-v-14601a5a",null);e.default=w.exports},jbi9:function(t,e,i){"use strict";var s={props:{config:{type:Object,default:function(){return{success:0,fail:0,tip:""}}},title:{type:String,default:"提示"}},data:function(){return{dialogShow:!0}},methods:{cancel:function(){this.$emit("close","cancel")}}},a={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dialog",{staticClass:"actived-dialog",attrs:{title:t.title,visible:t.dialogShow,width:"480px","append-to-body":"","close-on-click-modal":!1,"before-close":t.cancel},on:{"update:visible":function(e){t.dialogShow=e}}},[i("div",{staticClass:"tip-result"},[t._v("导入数量 "+t._s(t.config.total)+" ， 成功"),i("span",{staticClass:"tip-green m-l-5"},[t._v(t._s(t.config.success))]),t._v("，失败"),i("span",{staticClass:"tip-red m-l-5"},[t._v(t._s(t.config.fail))])]),t._v(" "),t.config.tip?i("div",{staticClass:"tip-error-text"},[t._v(t._s(t.config.tip))]):t._e(),t._v(" "),t._t("default"),t._v(" "),i("span",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{staticClass:"w-90",attrs:{round:"",size:"medium",type:"primary"},on:{click:t.cancel}},[t._v("确定")])],1)],2)},staticRenderFns:[]};var o=i("VU/8")(s,a,!1,function(t){i("pLGR")},"data-v-0a0a4b96",null);e.a=o.exports},pLGR:function(t,e){},q4Ms:function(t,e){}});
//# sourceMappingURL=21.21e589b300ad1b7d8322.js.map