webpackJsonp([25],{Nbqd:function(t,e){},Nse4:function(t,e){},z8fj:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n("IaGi"),i=n("ufHF"),s={props:{info:{type:Object,default:function(){return{}}}},data:function(){return{dialogVisible:!0,permissionsList:[],userList:[]}},created:function(){this.getDetail(this.info.id),this.getUsers()},methods:{cancel:function(t){this.$emit("close","cancel")},editFn:function(){this.$router.push({path:"/setting/role-power/edit",query:{roleId:this.info.id}})},getDetail:function(t){var e=this;this.$fetch.setting.roleInfo(t,{expand:"permissions"}).then(function(t){e.$handleResponse(t,function(t){e.handleData(t.role.permissions)},!0)}).catch(function(t){e.$store.commit("closeLoading")})},handleData:function(t){var e=this;this.$hasArrContent(t)&&t.forEach(function(t){if(t.checked){var n=[];e.$hasArrContent(t.child)&&t.child.forEach(function(t){if(t.checked){var a=[];e.$hasArrContent(t.child)&&t.child.forEach(function(t){t.checked&&a.push(t.name)}),e.$hasArrContent(a)?n.push(t.name+"("+a.join(",")+")"):n.push(t.name)}}),e.permissionsList.push({left:t.name,right:n.join("、")})}})},getUsers:function(){var t=this;this.$fetch.setting.queryAccountList({expand:"roles",roleId:this.info.id}).then(function(e){t.$handleResponse(e,function(e){t.handleUserData(e.list)},!0)}).catch(function(e){t.$store.commit("closeLoading")})},handleUserData:function(t){var e=this;this.$hasArrContent(t)&&t.forEach(function(t){var n=[];e.$hasArrContent(t.roles)&&t.roles.forEach(function(t){if(-1==["dcc_supervisor","dcc_inviter","dcc_group_leader"].indexOf(t.role_key)){var e=[];t.orgs&&t.orgs.length?(t.orgs.forEach(function(t){e.push(t.name)}),n.push(t.name+"("+e.join("、")+")")):n.push(t.name)}}),e.userList.push({name:(t.nickname?t.nickname:"--")+"("+(t.tel?t.tel:"--")+")",org:n.join("、")})})}}},o={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-dialog",{staticClass:"view-role-dialog",attrs:{title:"角色详情",visible:t.dialogVisible,width:"800px",appentToBody:"","close-on-click-modal":!1,"before-close":t.cancel},on:{"update:visible":function(e){t.dialogVisible=e}}},[n("el-form",{ref:"form",attrs:{"label-width":"110px"}},[n("el-form-item",{attrs:{label:"角色名称:"}},[t._v("\n            "+t._s(t._f("filterBlank")(t.info.name))+"\n        ")]),t._v(" "),n("el-form-item",{attrs:{label:"角色描述:"}},[t._v("\n            "+t._s(t._f("filterBlank")(t.info.desc))+"\n        ")]),t._v(" "),n("el-form-item",{attrs:{label:"权限:"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.permissionsList.length,expression:"permissionsList.length"}],staticClass:"box-wrap"},t._l(t.permissionsList,function(e,a){return n("div",{key:"pow"+a,staticClass:"flex box-item"},[n("div",{staticClass:"w-90 p-l-10 box-left"},[t._v(t._s(e.left))]),t._v(" "),n("div",{staticClass:"flex-1 p-r-10 box-right"},[n("p",{staticClass:"box-right-p"},[t._v(t._s(e.right))])])])}),0)]),t._v(" "),n("el-form-item",{attrs:{label:"用户:"}},[n("el-table",{staticClass:"user-table",attrs:{data:t.userList,border:!0,"max-height":"360"}},[n("el-table-column",{attrs:{prop:"name",label:"用户姓名",width:"300",align:"center"}}),t._v(" "),n("el-table-column",{attrs:{prop:"org",label:"管理范围",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",[t._v(t._s(t._f("filterBlank")(e.row.org)))])]}}])})],1)],1)],1),t._v(" "),n("span",{attrs:{slot:"footer"},slot:"footer"},[n("el-button",{staticClass:"w-90",attrs:{round:"",size:"small"},on:{click:t.cancel}},[t._v("关闭")]),t._v(" "),n("el-button",{staticClass:"w-90",attrs:{round:"",size:"small",type:"primary"},on:{click:function(e){return t.editFn()}}},[t._v(" 编辑")])],1)],1)},staticRenderFns:[]};var r=n("VU/8")(s,o,!1,function(t){n("Nse4")},"data-v-47c2affa",null).exports,l=n("PdD4"),c={components:{SearchCol:a.a,DataTable:i.a,ViewRole:r},mixins:[l.a],data:function(){return{showView:!1}},created:function(){this.initData(),this.queryData()},methods:{initData:function(){this.initSearch(),this.initTable()},initSearch:function(){this.search={list:[{prop:"keyword",type:"input",label:"角色名称",currentVal:""},{prop:"status",type:"select",label:"角色类型",currentVal:"",isAll:!0,isAllTitle:"全部",selectOptions:[{name:"系统角色",id:0},{name:"自定义角色",id:1}],optionLabel:"name",optionValue:"id"}],keyword:0,status:1}},initTable:function(){this.dataTable={tr:[{id:"1",label:"角色名称",prop:"name",tooltip:!0,show:"template",align:"center"},{id:"2",label:"角色描述",prop:"desc",tooltip:!0,align:"center"},{id:"3",label:"用户数",prop:"userCount",tooltip:!0,align:"center"},{id:"4",label:"角色类型",prop:"type",show:"template",align:"center"},{id:"5",label:"操作",prop:"caozuo",show:"template",width:230,align:"center"}],data:[],page:{totalCount:0,pageSize:20,currentPage:1},border:!0,hasSelect:!0,hasExpand:!1,hasFirstPagination:!0,showScrollBar:!0,checkboxInit:function(t,e){return t.type},search:{value:"",show:!1,url:"setting.queryRoleList",width:"300",placeholder:"线索号码、微信号",displayCol:["nickname","tel"],params:{id:""}}}},getParams:function(){var t=this.dataTable.page,e=t.currentPage,n=t.pageSize,a=this.search,i=a.keyword,s=a.status,o=a.list;return{expand:"userCount",name:o[i].currentVal,type:o[s].currentVal,pageSize:n,page:e}},queryData:function(){var t=this,e=this,n=this.getParams();this.$fetch.setting.queryRoleList(n).then(function(n){t.$handleResponse(n,function(t){e.dataTable.data=t.list?t.list:[],e.dataTable.page=t.page?t.page:e.dataTable.page},!0)}).catch(function(){t.$store.commit("closeLoading")})},handleFn:function(t,e){this.$router.push({path:"add"==t?"/setting/role-power/add":"/setting/role-power/edit",query:{roleId:e.id}})},viewFn:function(t){this.showView=!0,this.viewInfo=t},batchDel:function(t,e){var n=this;if("batch"!=t||this.$hasArrContent(this.selectData)){var a="batch"==t?"您确定要删除选中的角色吗?":"您确定要删除该角色吗";this.$confirm(a,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",customClass:"needCenterStyle",cancelButtonClass:"big cancel",confirmButtonClass:"big",roundButton:!0}).then(function(){n.deleteRole("batch"==t?n.selectData:e)})}else this.$message.warning("您还没选择角色")},deleteRole:function(t){var e=this,n=[];t.forEach(function(t){n.push(t.id)}),this.$fetch.setting.roleDelete(n.join(",")).then(function(t){e.$handleResponse(t,function(t){e.$message.success("删除成功"),e.queryData()},!0)}).catch(function(){e.$store.commit("closeLoading")})}}},u={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"setting-role-page m-20 common-box"},[n("div",{staticClass:"top-title"},[t._v("角色管理")]),t._v(" "),n("div",{staticClass:"search-flex p-l-r-20 m-t-30 line"},[n("search-col",{attrs:{info:t.search.list[t.search.keyword],placeholder:"请输入"}}),t._v(" "),n("search-col",{attrs:{info:t.search.list[t.search.status]}}),t._v(" "),n("search-col",{staticClass:"export-log-btn",attrs:{leftCol:0,rightCol:24}},[n("div",{attrs:{slot:"custom"},slot:"custom"},[n("el-button",{staticClass:"m-l-20 w-110",attrs:{round:"",icon:"el-icon-search",size:"small",type:"primary"},on:{click:t.find}},[t._v("查询")]),t._v(" "),n("el-button",{attrs:{round:"",icon:"el-icon-delete",size:"small",plain:""},on:{click:t.clear}},[t._v("清空查询条件")])],1)])],1),t._v(" "),n("div",{staticClass:"p-l-r-20 p-b-20"},[n("data-table",{ref:"DataTableRef",attrs:{table:t.dataTable},on:{searchTable:t.searchTable,onHandleSelectionChange:t.handleSelectionChange},scopedSlots:t._u([{key:"name",fn:function(e){return[n("el-button",{staticClass:"pointer",attrs:{type:"text"},on:{click:function(n){return t.viewFn(e.obj.row)}}},[t._v(t._s(e.obj.row.name))])]}},{key:"type",fn:function(e){return[t._v("\n                "+t._s(0==e.obj.row.type?"系统角色":"自定义角色")+"\n            ")]}},{key:"userCount",fn:function(e){return[t._v("\n                "+t._s(t._f("filterBlank")(e.obj.row.userCount))+" 个\n            ")]}},{key:"caozuo",fn:function(e){return[n("div",{staticClass:"text-left p-l-50"},[n("el-button",{staticClass:"blue_font_white_bg",attrs:{plain:"",round:"",size:"mini"},on:{click:function(n){return t.handleFn("edit",e.obj.row)}}},[t._v("编辑")]),t._v(" "),e.obj.row.type?n("el-button",{staticClass:"red_font_white_bg",attrs:{plain:"",round:"",size:"mini"},on:{click:function(n){return t.batchDel("one",[e.obj.row])}}},[t._v("删除")]):t._e()],1)]}}])},[n("div",{attrs:{slot:"buttons"},slot:"buttons"},[n("el-button",{attrs:{type:"primary",round:"",size:"small"},on:{click:function(e){return t.handleFn("add",{})}}},[t._v("新增角色")]),t._v(" "),n("el-button",{staticClass:"w-90",attrs:{plain:"",size:"small",round:""},on:{click:function(e){return t.batchDel("batch",[])}}},[t._v("删除")])],1)])],1),t._v(" "),t.showView?n("view-role",{attrs:{info:t.viewInfo},on:{close:function(e){t.showView=!1}}}):t._e()],1)},staticRenderFns:[]};var h=n("VU/8")(c,u,!1,function(t){n("Nbqd")},"data-v-310c452b",null);e.default=h.exports}});
//# sourceMappingURL=25.e0d8b8de7fc9fa14a457.js.map