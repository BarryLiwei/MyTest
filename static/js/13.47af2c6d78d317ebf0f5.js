webpackJsonp([13],{"7IuR":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("/Uby"),r=n("IaGi"),a=n("ufHF"),o=n("PdD4"),s=n("ZLEe"),l=n.n(s),c=n("kfhN"),d=n("+qDl"),m=n.n(d),p={props:{rowInfo:{type:Object,default:function(){return{}}}},components:{ScrmFormItem:c.a},data:function(){return{loading:!1,dialogVisible:!0,title:"新增活动",type:"add",info:{type:"",brandId:"",areaId:[],title:"",content:"",time:[]},checked:!1,optionsInfo:{type:[],brand:[],area:[]},minTime:m()(new Date).subtract(1,"day")}},created:function(){l()(this.rowInfo).length&&(this.title="编辑活动",this.type="edit",this.taskView()),this.initTypeOptions()},methods:{initTypeOptions:function(){this.optionsInfo.type=[{id:2,title:"集团活动"},{id:3,title:"品牌活动"},{id:4,title:"其他活动"}]},taskView:function(){var e=this;this.$fetch.callCenter.activityView({id:this.rowInfo.id}).then(function(t){e.$handleResponse(t,function(t){var n=t;e.info.type=n.activityType,n.endDate&&(e.info.time.length=0,e.info.time.push(n.startDate),e.info.time.push(n.endDate)),e.typeChange(),e.info.areaId=[],n.areas.forEach(function(t){e.info.areaId.push(t.id)}),e.info.brandId=n.brandId,e.info.title=n.title,e.info.content=n.content},!0)}).catch(function(){e.$store.commit("closeLoading")})},cancel:function(){this.$emit("close","cancel")},getParmam:function(){var e=this.info,t=e.type,n=e.brandId,i=e.areaId,r=e.title,a=e.content,o=e.time;if(!o.length)return this.$message.error("有效期未填写，请完成填写再提交"),!1;if(!t)return this.$message.error("活动类型未填写，请完成填写再提交"),!1;if(t&&3==t&&!n)return this.$message.error("品牌未填写，请完成填写再提交"),!1;if(t&&4==t&&!i.length)return this.$message.error("适用门店未填写，请完成填写再提交"),!1;if(!r)return this.$message.error("活动标题未填写，请完成填写再提交"),!1;if(!a)return this.$message.error("内容未填写，请完成填写再提交"),!1;var s={type:t,title:r,content:a,startDate:o&&o[0],endDate:o&&o[1]};return 3==s.type?s.brandId=n:4==s.type&&(s.areaId=i),s},addFn:function(){var e=this,t=this.getParmam();t&&("add"==this.type?this.$fetch.callCenter.activityCreate(t).then(function(t){e.$handleResponse(t,function(t){e.$message.success("新增成功"),e.$emit("close","success")},!0)}).catch(function(){e.$store.commit("closeLoading")}):(t.id=this.rowInfo.id,this.$fetch.callCenter.activityUpdate(t).then(function(t){e.$handleResponse(t,function(t){e.$message.success("编辑成功"),e.$emit("close","success")},!0)}).catch(function(){e.$store.commit("closeLoading")})))},typeChange:function(){3==this.info.type?this.initBrandOptions():4==this.info.type&&this.initAreaOptions()},initBrandOptions:function(){var e=this;this.$fetch.common.carBrand({}).then(function(t){e.$handleResponse(t,function(t){e.optionsInfo.brand=t},!0)}).catch(function(){e.$store.commit("closeLoading")})},initAreaOptions:function(){var e=this;this.$fetch.common.commonAreaList({}).then(function(t){e.$handleResponse(t,function(t){e.optionsInfo.area=t},!0)}).catch(function(){e.$store.commit("closeLoading")})}}},f=function(){var e=this,t=this,n=t.$createElement,i=t._self._c||n;return i("el-dialog",{staticClass:"add-talk-task-dialog",attrs:{title:t.title,visible:t.dialogVisible,width:"650px",appentToBody:"","close-on-click-modal":!1,"before-close":t.cancel},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",attrs:{"label-width":"110px"}},[i("scrm-form-item",{staticClass:"form-task-time",attrs:{itemInfo:t.info,itemKey:"time",itemLabel:"有效期",itemRequired:!0,itemClass:"form_required_after",itemType:"datePicker",subClass:"w-400",type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd",disabled:t.checked,"picker-options":{disabledDate:function(t){return t<new Date(e.minTime).getTime()}}}}),t._v(" "),i("scrm-form-item",{attrs:{itemInfo:t.info,itemKey:"type",itemLabel:"活动类型",itemRequired:!0,itemClass:"form_required_after",itemType:"select",subClass:"w-400",placeholder:"请选择",filterable:!0,selectOptions:t.optionsInfo.type,optionLabel:"title",optionValue:"id"},on:{change:function(e){return t.typeChange()}}}),t._v(" "),i("scrm-form-item",{directives:[{name:"show",rawName:"v-show",value:3==t.info.type,expression:"info.type == 3"}],attrs:{itemInfo:t.info,itemKey:"brandId",itemLabel:"适用品牌",itemRequired:!0,itemClass:"form_required_after",itemType:"select",subClass:"w-400",placeholder:"请选择",filterable:!0,selectOptions:t.optionsInfo.brand,optionLabel:"title",optionValue:"id"}}),t._v(" "),i("scrm-form-item",{directives:[{name:"show",rawName:"v-show",value:4==t.info.type,expression:"info.type == 4"}],attrs:{itemInfo:t.info,itemKey:"areaId",itemLabel:"适用门店",itemRequired:!0,itemClass:"form_required_after",itemType:"select",multiple:"",subClass:"w-400",placeholder:"请选择",filterable:!0,selectOptions:t.optionsInfo.area,optionLabel:"title",optionValue:"id"}}),t._v(" "),t.info.type?i("scrm-form-item",{attrs:{itemInfo:t.info,itemKey:"title",itemLabel:"活动标题",itemRequired:!0,itemClass:"form_required_after",itemType:"input",subClass:"w-400",maxlength:"20",placeholder:"20个字符以内"}}):t._e(),t._v(" "),t.info.type?i("scrm-form-item",{attrs:{itemInfo:t.info,itemKey:"content",itemLabel:"内容",itemRequired:!0,itemClass:"form_required_after",itemType:"input",type:"textarea",autosize:{minRows:4},subClass:"w-400",maxlength:"500",placeholder:"请输入活动内容","show-word-limit":""}}):t._e()],1),t._v(" "),i("span",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{staticClass:"w-90",attrs:{round:"",size:"small"},on:{click:t.cancel}},[t._v("取 消")]),t._v(" "),i("el-button",{staticClass:"w-90",attrs:{round:"",size:"small",type:"primary"},on:{click:t.addFn}},[t._v("确 定")])],1)],1)};f._withStripped=!0;var u={render:f,staticRenderFns:[]},h=u;var y=!1;var v=n("C7Lr")(p,h,!1,function(e){y||(n("8ks8"),n("jxKr"))},"data-v-7e51de96",null);v.options.__file="src/pages/call-center/know/activity/AddActivity.vue";var g=v.exports,b={components:{ScrmFormItem:c.a},props:{id:{type:[String,Number],default:""}},data:function(){return{dialogVisible:!0,checked:!0,loading:!1,viewInfo:{}}},created:function(){this.taskView()},methods:{cancel:function(){this.$emit("cancel")},taskView:function(){var e=this;this.$fetch.callCenter.activityView({id:this.id}).then(function(t){e.$handleResponse(t,function(t){e.viewInfo=t,e.viewInfo.areasName=[],t.areas.forEach(function(t){e.viewInfo.areasName.push(t.areaName)}),e.viewInfo.areasLength=e.viewInfo.areasName.length},!0)}).catch(function(){e.$store.commit("closeLoading")})}}},w=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{staticClass:"view-talk-task-dialog",attrs:{title:"活动详情",visible:e.dialogVisible,width:"500px",appentToBody:"","close-on-click-modal":!1,"before-close":e.cancel},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{"label-width":"110px"}},[n("scrm-form-item",{attrs:{itemLabel:"有效期",itemType:"input",itemInfo:{},editable:!1}},[n("template",{slot:"notEdit"},[e._v("\n                 "+e._s(e.viewInfo.startDate)+" 至 "+e._s(e.viewInfo.endDate)+"\n            ")])],2),e._v(" "),n("scrm-form-item",{attrs:{itemLabel:"活动类型",itemType:"input",itemInfo:e.viewInfo,itemKey:"activityTypeTitle",editable:!1}}),e._v(" "),n("scrm-form-item",{directives:[{name:"show",rawName:"v-show",value:3==e.viewInfo.activityType,expression:"viewInfo.activityType == 3"}],attrs:{itemLabel:"适用品牌",itemType:"input",itemInfo:e.viewInfo,itemKey:"brand",editable:!1}}),e._v(" "),n("scrm-form-item",{directives:[{name:"show",rawName:"v-show",value:4==e.viewInfo.activityType,expression:"viewInfo.activityType == 4"}],attrs:{itemLabel:"适用门店("+e.viewInfo.areasLength+")",itemType:"input",itemInfo:{},editable:!1}},[n("template",{slot:"notEdit"},e._l(e.viewInfo.areasName,function(t,i){return n("span",{key:i},[0!=i?n("i",[e._v("、")]):e._e(),e._v(e._s(t))])}),0)],2),e._v(" "),n("scrm-form-item",{attrs:{itemLabel:"活动标题",itemType:"input",itemInfo:e.viewInfo,itemKey:"title",editable:!1}}),e._v(" "),n("scrm-form-item",{attrs:{itemLabel:"内容",itemType:"input",itemInfo:e.viewInfo,itemKey:"content",editable:!1,isEllipsis:!1}})],1)],1)};w._withStripped=!0;var A={render:w,staticRenderFns:[]},_=A;var C=!1;var I=n("C7Lr")(b,_,!1,function(e){C||n("MFJ4")},"data-v-4e94f082",null);I.options.__file="src/pages/call-center/know/activity/ViewActivity.vue";var k=I.exports,x={components:{SearchBar:i.a,SearchCol:r.a,DataTable:a.a,AddActivity:g,ViewActivity:k},mixins:[o.a],data:function(){return{showAdd:!1,showView:!1,currentRow:{}}},created:function(){this.initData(),this.queryData()},methods:{initData:function(){this.initSearch(),this.initTable(),this.getAreaOptions()},initSearch:function(){this.search={list:[{prop:"area",type:"select",label:"归属门店",currentVal:"",isAll:!0,isAllTitle:"全部",selectOptions:[],optionLabel:"title",optionValue:"id"},{prop:"type",type:"select",label:"活动类型",currentVal:"",isAll:!0,isAllTitle:"全部",selectOptions:[{id:1,title:"门店活动"},{id:2,title:"集团活动"},{id:3,title:"品牌活动"},{id:4,title:"其他活动"}],optionLabel:"title",optionValue:"id"},{prop:"createDate",type:"datePicker",label:"创建时间",currentVal:""},{prop:"validDate",type:"datePicker",label:"有效期",currentVal:""}],area:0,type:1,createDate:2,validDate:3}},initTable:function(){this.dataTable={tr:[{id:"1",label:"任务ID",prop:"longId",tooltip:!0},{id:"2",label:"适用门店",prop:"areaOverview",tooltip:!0,minWidth:"150"},{id:"3",label:"活动类型",prop:"activityTypeTitle",tooltip:!0,minWidth:"100"},{id:"4",label:"活动标题",prop:"title",tooltip:!0,minWidth:"110"},{id:"5",label:"有效期",prop:"startDate",show:"template",tooltip:!0,minWidth:"185"},{id:"6",label:"创建时间",prop:"createdDate",tooltip:!0,minWidth:"150"},{id:"7",label:"操作选项",prop:"caozuo",show:"template",width:"250"}],data:[],page:{totalCount:0,pageSize:20,currentPage:1},border:!0,hasSelect:!0,hasExpand:!1,hasFirstPagination:!0,showScrollBar:!0,search:{value:"",show:!0,url:"callCenter.activityList",width:"300",placeholder:"请输入活动ID/活动标题",displayCol:["longId","title"],params:{id:""},keyword:"kwd"}}},getParams:function(){var e=this.dataTable.page,t=e.currentPage,n=e.pageSize,i=this.search,r=i.area,a=i.type,o=i.createDate,s=i.validDate,l=i.list;return{area:l[r].currentVal,type:l[a].currentVal,createDateStart:l[o].currentVal&&l[o].currentVal[0],createDateEnd:l[o].currentVal&&l[o].currentVal[1],validDateStart:l[s].currentVal&&l[s].currentVal[0],validDateEnd:l[s].currentVal&&l[s].currentVal[1],pageSize:n,page:t}},queryData:function(){var e=this,t=this,n=this.getParams();this.$fetch.callCenter.activityList(n,!0).then(function(n){e.$handleResponse(n,function(e){t.dataTable.data=e.list?e.list:[],t.dataTable.page=e.page?e.page:t.dataTable.page},!0)}).catch(function(){e.$store.commit("closeLoading")})},batchDelete:function(){var e=this;console.log(this.selectData),this.$hasArrContent(this.selectData)?this.$confirm("您确定要删除选中的活动吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",customClass:"needCenterStyle",cancelButtonClass:"big cancel",confirmButtonClass:"big",roundButton:!0}).then(function(){var t=[];e.selectData.forEach(function(e){t.push(e.id)}),e.$fetch.callCenter.activityDelete({id:t}).then(function(t){e.$handleResponse(t,function(t){e.$message.success("删除成功"),e.queryData()},!0)}).catch(function(){e.$store.commit("closeLoading")})}):this.$message.warning("您还没选择活动")},deleteFn:function(e){var t=this;this.$confirm("删除后不可恢复，是否确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",customClass:"needCenterStyle",cancelButtonClass:"big cancel",confirmButtonClass:"big",roundButton:!0}).then(function(){t.$fetch.callCenter.activityDelete({id:[e.id]}).then(function(e){t.$handleResponse(e,function(e){t.$message.success("删除成功"),t.queryData()},!0)}).catch(function(){t.$store.commit("closeLoading")})})},viewFn:function(e){this.currentRow=e,this.showView=!0},HandleFn:function(e,t){this.currentRow=t,this.showAdd=!0},closeShowAdd:function(){this.showAdd=!1,this.queryData()}}},$=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"activity-page m-20 common-box"},[n("search-bar",{staticClass:"m-t-10 p-20",attrs:{size:"medium"},on:{clear:e.clear,find:e.find}},[n("div",{staticClass:"search-flex"},[n("search-col",{attrs:{info:e.search.list[e.search.area],leftCol:8,filterable:""}}),e._v(" "),n("search-col",{attrs:{info:e.search.list[e.search.type]}}),e._v(" "),n("search-col",{attrs:{info:e.search.list[e.search.createDate],leftCol:8,type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"}}),e._v(" "),n("search-col",{attrs:{info:e.search.list[e.search.validDate],leftCol:8,type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"}})],1)]),e._v(" "),n("div",{staticClass:"p-l-r-20 p-b-20"},[n("data-table",{ref:"DataTableRef",attrs:{table:e.dataTable},on:{searchTable:e.searchTable,onHandleSelectionChange:e.handleSelectionChange},scopedSlots:e._u([{key:"caozuo",fn:function(t){return[n("el-button",{staticClass:"blue_font_white_bg",attrs:{plain:"",round:"",size:"mini"},on:{click:function(n){return e.viewFn(t.obj.row)}}},[e._v("查看")]),e._v(" "),1!=t.obj.row.activityType?n("el-button",{staticClass:"blue_font_white_bg",attrs:{plain:"",round:"",size:"mini"},on:{click:function(n){return e.HandleFn("edit",t.obj.row)}}},[e._v("编辑")]):e._e(),e._v(" "),1!=t.obj.row.activityType?n("el-button",{staticClass:"red_font_white_bg",attrs:{plain:"",round:"",size:"mini"},on:{click:function(n){return e.deleteFn(t.obj.row)}}},[e._v("删除")]):e._e()]}},{key:"startDate",fn:function(t){return[n("div",[e._v("\n                    "+e._s(t.obj.row.startDate)+" 至 "+e._s(t.obj.row.endDate)+"\n                ")])]}}])},[n("div",{attrs:{slot:"buttons"},slot:"buttons"},[n("el-button",{attrs:{type:"primary",icon:"el-icon-plus",round:"",size:"small"},on:{click:function(t){return e.HandleFn("add",{})}}},[e._v("新增活动")]),e._v(" "),n("el-button",{staticClass:"w-90",attrs:{plain:"",size:"small",round:""},on:{click:e.batchDelete}},[e._v("删除")])],1)])],1),e._v(" "),e.showAdd?n("add-activity",{attrs:{rowInfo:e.currentRow},on:{close:e.closeShowAdd}}):e._e(),e._v(" "),e.showView?n("view-activity",{attrs:{id:e.currentRow.id},on:{cancel:function(t){e.showView=!1}}}):e._e()],1)};$._withStripped=!0;var T={render:$,staticRenderFns:[]},D=T;var B=!1;var L=n("C7Lr")(x,D,!1,function(e){B||n("npzd")},"data-v-7792e9fa",null);L.options.__file="src/pages/call-center/know/activity/Activity.vue";t.default=L.exports},"8ks8":function(e,t,n){var i=n("to+R");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);n("FIqI")("415ad0aa",i,!1,{})},DMbN:function(e,t,n){(e.exports=n("UTlt")(!0)).push([e.i,"\n.view-talk-task-dialog[data-v-4e94f082] .el-dialog__body{padding:20px 20px 30px\n}\n.el-form-item[data-v-4e94f082]{margin-bottom:6px\n}\n.el-form-item[data-v-4e94f082] .el-form-item__label{padding-right:25px\n}\n.el-tag[data-v-4e94f082]{margin-right:10px\n}\n.custom-form.el-form-item[data-v-4e94f082]{margin-bottom:0\n}\n.custom-form.el-form-item[data-v-4e94f082] .el-form-item__label,.custom-form.el-form-item[data-v-4e94f082] .el-form-item__content{height:32px;line-height:32px\n}\n","",{version:3,sources:["D:/liu/vue-project/MyTest/src/pages/call-center/know/activity/D:/liu/vue-project/MyTest/src/pages/call-center/know/activity/ViewActivity.vue"],names:[],mappings:";AAgFA,yDACI,sBAAuB;CAC1B;AAAA,+BAGG,iBAAkB;CACrB;AAAA,oDAEG,kBAAmB;CACtB;AAAA,yBAEG,iBAAkB;CACrB;AAAA,2CAGG,eAAgB;CACnB;AAAA,kIAIG,YACA,gBAAiB;CACpB",file:"ViewActivity.vue",sourcesContent:["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\n.view-talk-task-dialog /deep/.el-dialog__body {\r\n    padding: 20px 20px 30px;\r\n}\r\n\r\n.el-form-item {\r\n    margin-bottom: 6px;\r\n}\r\n.el-form-item /deep/.el-form-item__label{\r\n    padding-right: 25px;\r\n}\r\n.el-tag {\r\n    margin-right: 10px;\r\n}\r\n\r\n.custom-form.el-form-item {\r\n    margin-bottom: 0;\r\n}\r\n\r\n.custom-form.el-form-item /deep/.el-form-item__label,\r\n.custom-form.el-form-item /deep/ .el-form-item__content{\r\n    height: 32px;\r\n    line-height: 32px;\r\n}\r\n"],sourceRoot:""}])},MFJ4:function(e,t,n){var i=n("DMbN");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);n("FIqI")("36fb0fc2",i,!1,{})},dect:function(e,t,n){(e.exports=n("UTlt")(!0)).push([e.i,"","",{version:3,sources:[],names:[],mappings:"",file:"Activity.vue",sourceRoot:""}])},jxKr:function(e,t,n){var i=n("wXXZ");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);n("FIqI")("1a852576",i,!1,{})},npzd:function(e,t,n){var i=n("dect");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);n("FIqI")("2ef079a7",i,!1,{})},"to+R":function(e,t,n){(e.exports=n("UTlt")(!0)).push([e.i,"\n.add-talk-task-dialog[data-v-7e51de96] .el-dialog__body{padding:25px 35px 0 20px\n}\n.add-talk-task-dialog[data-v-7e51de96] .el-dialog__footer{padding-bottom:37px\n}\n.el-form-item[data-v-7e51de96],.form-task-limit.el-form-item[data-v-7e51de96]{margin-bottom:10px\n}\n.w-60[data-v-7e51de96]{width:60px\n}\n.span-icon[data-v-7e51de96]{display:inline-block;width:38px;height:38px;cursor:pointer;vertical-align:middle\n}\n","",{version:3,sources:["D:/liu/vue-project/MyTest/src/pages/call-center/know/activity/D:/liu/vue-project/MyTest/src/pages/call-center/know/activity/AddActivity.vue"],names:[],mappings:";AAkOA,wDACI,wBAAyB;CAC5B;AAAA,0DAGG,mBAAoB;CACvB;AAAA,8EAOG,kBAAmB;CACtB;AAAA,uBAEG,UAAW;CACd;AAAA,4BAGG,qBACA,WACA,YACA,eACA,qBAAsB;CACzB",file:"AddActivity.vue",sourcesContent:["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\n.add-talk-task-dialog /deep/.el-dialog__body {\r\n    padding: 25px 35px 0 20px;\r\n}\r\n\r\n.add-talk-task-dialog /deep/.el-dialog__footer {\r\n    padding-bottom: 37px;\r\n}\r\n\r\n.form-task-time.el-form-item {\r\n    // margin-bottom: 5px;\r\n}\r\n.el-form-item,\r\n.form-task-limit.el-form-item {\r\n    margin-bottom: 10px;\r\n}\r\n.w-60 {\r\n    width: 60px;\r\n}\r\n\r\n.span-icon {\r\n    display: inline-block;\r\n    width: 38px;\r\n    height: 38px;\r\n    cursor: pointer;\r\n    vertical-align: middle;\r\n}\r\n\r\n"],sourceRoot:""}])},wXXZ:function(e,t,n){(e.exports=n("UTlt")(!0)).push([e.i,"\n.add-talk-task-dialog /deep/.form-task-time /deep/.el-input__inner {\r\n    width: 400px;\n}\r\n","",{version:3,sources:["D:/liu/vue-project/MyTest/src/pages/call-center/know/activity/src/pages/call-center/know/activity/AddActivity.vue"],names:[],mappings:";AAgQA;IACA,aAAA;CACA",file:"AddActivity.vue",sourcesContent:['<template>\r\n    <el-dialog\r\n      :title="title"\r\n      class="add-talk-task-dialog"\r\n      :visible.sync="dialogVisible"\r\n      width="650px"\r\n      appentToBody\r\n      :close-on-click-modal="false"\r\n      :before-close="cancel">\r\n        <el-form ref="form" label-width="110px" v-loading="loading">\r\n            <scrm-form-item :itemInfo="info" itemKey="time" itemLabel="有效期" :itemRequired="true" itemClass="form_required_after"  class="form-task-time" \r\n                itemType="datePicker" subClass="w-400" type="daterange" range-separator="至" start-placeholder="开始日期" end-placeholder="结束日期" value-format="yyyy-MM-dd" :disabled="checked"\r\n                :picker-options="{\r\n                    disabledDate: time => {\r\n                        return time < new Date(this.minTime).getTime();\r\n                    },\r\n                }"></scrm-form-item>\r\n\r\n            <scrm-form-item  :itemInfo="info"  itemKey="type" itemLabel="活动类型"  :itemRequired="true"  itemClass="form_required_after"  \r\n                itemType="select"  subClass="w-400" placeholder="请选择" :filterable="true" :selectOptions="optionsInfo.type"  :optionLabel="\'title\'" :optionValue="\'id\'" @change="typeChange()"></scrm-form-item>\r\n\r\n            <scrm-form-item v-show="info.type == 3" :itemInfo="info" itemKey="brandId" itemLabel="适用品牌"  :itemRequired="true"  itemClass="form_required_after"  \r\n                itemType="select"  subClass="w-400" placeholder="请选择" :filterable="true" :selectOptions="optionsInfo.brand"  :optionLabel="\'title\'" :optionValue="\'id\'"></scrm-form-item>\r\n\r\n            <scrm-form-item v-show="info.type == 4" :itemInfo="info" itemKey="areaId" itemLabel="适用门店"  :itemRequired="true"  itemClass="form_required_after"  \r\n                itemType="select" multiple  subClass="w-400" placeholder="请选择" :filterable="true" :selectOptions="optionsInfo.area"  :optionLabel="\'title\'" :optionValue="\'id\'"></scrm-form-item>\r\n\r\n            <scrm-form-item v-if="info.type" :itemInfo="info"  itemKey="title" itemLabel="活动标题"  :itemRequired="true"  itemClass="form_required_after" \r\n                itemType="input"  subClass="w-400" maxlength="20"  placeholder="20个字符以内">\r\n            </scrm-form-item>\r\n\r\n            <scrm-form-item v-if="info.type" :itemInfo="info"  itemKey="content" itemLabel="内容"  :itemRequired="true"  itemClass="form_required_after" \r\n                itemType="input" type="textarea" :autosize="{ minRows: 4}" subClass="w-400" maxlength="500"  placeholder="请输入活动内容" show-word-limit>\r\n            </scrm-form-item>\r\n        </el-form>\r\n\r\n      <span slot="footer">\r\n        <el-button round size="small" class="w-90" @click="cancel">取 消</el-button>\r\n        <el-button round size="small" class="w-90" @click="addFn" type="primary">确 定</el-button>\r\n      </span>\r\n    </el-dialog>\r\n</template>\r\n\r\n<script>\r\nimport ScrmFormItem from \'@/components/form/ScrmFormItem\'\r\nimport moment from \'moment\'\r\nexport default {\r\n    props: {\r\n        rowInfo: {\r\n            type: Object,\r\n            default: ()=>{ \r\n                return {}\r\n            }\r\n        }\r\n    },\r\n    components: {\r\n        ScrmFormItem\r\n    },\r\n    data(){\r\n        return{\r\n            loading: false,\r\n            dialogVisible: true,\r\n            title: \'新增活动\',\r\n            type: \'add\',\r\n            info:{\r\n                type: \'\',\r\n                brandId: \'\',\r\n                areaId: [],\r\n                title: \'\',\r\n                content: \'\',\r\n                time: [],    // "endDate": "2020-08-01 12:00"  过期时间，没有过期时间传0\r\n            },\r\n            checked: false,\r\n            optionsInfo: {\r\n                type: [],\r\n                brand: [],\r\n                area: []\r\n            },\r\n            minTime:moment(new Date()).subtract(1, \'day\'),\r\n        }\r\n    },\r\n    created(){\r\n        if(Object.keys(this.rowInfo).length){\r\n            this.title = \'编辑活动\';\r\n            this.type = \'edit\';\r\n            this.taskView();\r\n        }\r\n        this.initTypeOptions();\r\n    },\r\n    methods: {\r\n        initTypeOptions(){\r\n            this.optionsInfo.type = [\r\n                {\r\n                    "id": 2,\r\n                    "title": "集团活动"\r\n                },\r\n                {\r\n                    "id": 3,\r\n                    "title": "品牌活动"\r\n                },\r\n                {\r\n                    "id": 4,\r\n                    "title": "其他活动"\r\n                }\r\n            ]\r\n        },\r\n        taskView(){\r\n            this.$fetch.callCenter.activityView({\'id\': this.rowInfo.id}).then((res)=>{\r\n                this.$handleResponse(res, res => {\r\n                    let result = res;\r\n                    this.info.type = result.activityType;\r\n                    if(result.endDate){\r\n                        this.info.time.length = 0;\r\n                        this.info.time.push(result.startDate);\r\n                        this.info.time.push(result.endDate);\r\n                    }\r\n                    this.typeChange();\r\n                    this.info.areaId = [];\r\n                    result.areas.forEach(element => {\r\n                        this.info.areaId.push(element.id)\r\n                    });\r\n                    this.info.brandId = result.brandId;\r\n                    this.info.title = result.title;\r\n                    this.info.content = result.content;\r\n\r\n                    \r\n                },true);\r\n            }).catch(()=>{\r\n                this.$store.commit("closeLoading");\r\n            })\r\n        },\r\n        cancel(){\r\n            this.$emit(\'close\', \'cancel\');\r\n        },\r\n        getParmam(){\r\n            const { type, brandId, areaId, title, content, time} = this.info;\r\n            if(!time.length){\r\n                this.$message.error(\'有效期未填写，请完成填写再提交\')\r\n                return false;\r\n            }\r\n            if(!type){\r\n                this.$message.error(\'活动类型未填写，请完成填写再提交\')\r\n                return false;\r\n            }\r\n            if(type && type == 3 && !brandId){\r\n                this.$message.error(\'品牌未填写，请完成填写再提交\')\r\n                return false;\r\n            }\r\n            if(type && type == 4 && !areaId.length){\r\n                this.$message.error(\'适用门店未填写，请完成填写再提交\')\r\n                return false;\r\n            }\r\n            if(!title){\r\n                this.$message.error(\'活动标题未填写，请完成填写再提交\')\r\n                return false;\r\n            }\r\n            if(!content){\r\n                this.$message.error(\'内容未填写，请完成填写再提交\')\r\n                return false;\r\n            }\r\n            \r\n            let params = {\r\n                type: type,       // 活动类型\r\n                title: title,      // 标题\r\n                content: content,      // 内容\r\n                startDate: time && time[0],\r\n                endDate: time && time[1]\r\n            }\r\n            if(params.type == 3){\r\n                params.brandId = brandId;\r\n            }else if(params.type == 4){\r\n                params.areaId = areaId;\r\n            }\r\n            return params;\r\n        },\r\n        addFn(){\r\n            let params = this.getParmam();\r\n            if(params){\r\n                if(this.type == \'add\'){\r\n                    this.$fetch.callCenter.activityCreate(params).then((res)=>{\r\n                        this.$handleResponse(res, res => {\r\n                            this.$message.success(\'新增成功\');\r\n                            this.$emit(\'close\', \'success\')\r\n                        },true);\r\n                    }).catch(()=>{ this.$store.commit("closeLoading");})\r\n                }else {\r\n                    params[\'id\'] = this.rowInfo.id;\r\n                    this.$fetch.callCenter.activityUpdate(params).then((res)=>{\r\n                        this.$handleResponse(res, res => {\r\n                            this.$message.success(\'编辑成功\');\r\n                            this.$emit(\'close\', \'success\')\r\n                        },true);\r\n                    }).catch(()=>{ this.$store.commit("closeLoading");})\r\n                }\r\n            }\r\n        },\r\n        typeChange(){\r\n            if(this.info.type == 3){\r\n                this.initBrandOptions();\r\n            }else if(this.info.type == 4){\r\n                this.initAreaOptions();\r\n            }\r\n        },\r\n        initBrandOptions(){\r\n            this.$fetch.common.carBrand({}).then((res)=>{\r\n                this.$handleResponse(res, res => {\r\n                    this.optionsInfo.brand = res;\r\n                },true);\r\n            }).catch(()=>{\r\n                this.$store.commit("closeLoading");\r\n            })\r\n        },\r\n        initAreaOptions(){\r\n            this.$fetch.common.commonAreaList({}).then((res)=>{\r\n                this.$handleResponse(res, res => {\r\n                    this.optionsInfo.area = res;\r\n                },true);\r\n            }).catch(()=>{\r\n                this.$store.commit("closeLoading");\r\n            })\r\n        }\r\n    }\r\n}\r\n<\/script>\r\n\r\n<style lang="scss" scoped>\r\n.add-talk-task-dialog /deep/.el-dialog__body {\r\n    padding: 25px 35px 0 20px;\r\n}\r\n\r\n.add-talk-task-dialog /deep/.el-dialog__footer {\r\n    padding-bottom: 37px;\r\n}\r\n\r\n.form-task-time.el-form-item {\r\n    // margin-bottom: 5px;\r\n}\r\n.el-form-item,\r\n.form-task-limit.el-form-item {\r\n    margin-bottom: 10px;\r\n}\r\n.w-60 {\r\n    width: 60px;\r\n}\r\n\r\n.span-icon {\r\n    display: inline-block;\r\n    width: 38px;\r\n    height: 38px;\r\n    cursor: pointer;\r\n    vertical-align: middle;\r\n}\r\n\r\n</style>\r\n\r\n<style>\r\n.add-talk-task-dialog /deep/.form-task-time /deep/.el-input__inner {\r\n    width: 400px;\r\n}\r\n</style>\r\n\r\n'],sourceRoot:""}])}});
//# sourceMappingURL=13.47af2c6d78d317ebf0f5.js.map