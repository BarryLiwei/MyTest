webpackJsonp([18],{"+QqN":function(t,e){},"7M/F":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("woOf"),s=i.n(a),n=i("/Uby"),o=i("IaGi"),l=i("ufHF"),c=i("kfhN"),r=i("oFuF"),d={components:{ScrmFormItem:c.a},props:{info:{type:Object,default:function(){return{}}},type:{type:String,default:"add"},shopList:{type:Array,default:function(){return[]}},mediaOptions:{type:Array,default:function(){return[]}}},data:function(){return{dialogVisible:!0,showView:!1,title:"新增垂媒账号",media:{id:""},dialogType:"",mediaTable:[{type_text:"",type:"",id:"",account_name:"",account_pwd:"",options:[]}],selectId:[],loading:!1,shopOptions:[]}},created:function(){this.dialogType=this.type,"add"==this.type?(this.title="新增垂媒账号",this.shopOptions=this.$deepCopyContent(this.shopList),this.shopOptions&&this.shopOptions.length&&(this.info.short_name=this.shopOptions[0].short_name,this.info.shopId=this.shopOptions[0].id),this.mediaTable[0].options=this.$deepCopyContent(this.mediaOptions)):"view"==this.type&&(this.showView=!0,this.title="查看详情",this.media=this.$deepCopyContent(this.info))},computed:{btnName:function(){return"add"==this.dialogType?"确定":"view"==this.dialogType?"编辑":"保存"}},methods:{addFn:function(){var t=this;if("view"==this.dialogType)return this.dialogType="edit",this.showView=!1,this.title="编辑",this.mediaTable=this.$deepCopyContent(this.media.account),this.mediaTable.length&&(this.mediaTable.forEach(function(e){t.$set(e,"options",t.$deepCopyContent(t.mediaOptions))}),this.selectChange()),this.shopOptions=this.$deepCopyContent(this.shopList),void(this.shopOptions=Object(r.a)([this.info],"id","short_name",this.shopOptions,"id","title"));this.updateMedia()},getParams:function(){var t=[];if(this.mediaTable.length)for(var e=0,i=this.mediaTable.length;e<i;e++)t.push({id:this.mediaTable[e].id,type:this.mediaTable[e].type,account_name:this.mediaTable[e].account_name,account_pwd:this.mediaTable[e].account_pwd});return{area_id:this.media.id,accounts:t}},updateMedia:function(){var t=this,e=this.getParams();this.loading=!0,this.$fetch.callCenter.mediaAccountEdit(e).then(function(e){t.loading=!1,t.$handleResponse(e,function(e){t.$message.success(("add"==t.dialogType?"新增":"编辑")+"成功"),t.$emit("close","success")},!0)}).catch(function(){t.loading=!1,t.$store.commit("closeLoading")})},cancel:function(){if("edit"==this.dialogType)return this.dialogType="view",this.title="查看详情",this.showView=!0,void(this.media=this.$deepCopyContent(this.info));this.$emit("close","cancel")},addCount:function(){var t={type_text:"",type:"",id:"",account_name:"",account_pwd:"",options:this.$deepCopyContent(this.mediaOptions)};this.mediaTable.push(t),this.selectChange()},selectChange:function(){this.getSelectId(),this.checkDisabled()},getSelectId:function(){var t=this;this.selectId=[],this.mediaTable.forEach(function(e){e.type&&t.selectId.push(e.type)})},checkDisabled:function(){var t=this;this.$hasArrContent(this.selectId)&&this.$hasArrContent(this.mediaTable)&&this.mediaTable.forEach(function(e){e.options&&e.options.length&&(e.options=t.$deepCopyContent(t.mediaOptions),t.contrast(e))})},contrast:function(t){this.selectId&&this.selectId.forEach(function(e){for(var i=0;i<t.options.length;i++)if(e!=t.id&&e==t.options[i].val){t.options[i].disabled=!0;break}})},deleteFn:function(t){this.mediaTable.splice(t,1),this.selectChange()},changeArea:function(t){var e=this;this.loading=!0,this.$fetch.callCenter.getAccountByArea({id:t}).then(function(t){e.loading=!1,e.$handleResponse(t,function(t){e.mediaTable=e.$hasArrContent(t)?t:[],e.mediaTable.length&&(e.mediaTable.forEach(function(t){e.$set(t,"options",e.$deepCopyContent(e.mediaOptions))}),e.selectChange())},!1)}).catch(function(){e.loading=!1})}}},h={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dialog",{staticClass:"add-media-dialog",attrs:{title:t.title,visible:t.dialogVisible,width:"870px","append-to-body":"","close-on-click-modal":!1,"before-close":t.cancel},on:{"update:visible":function(e){t.dialogVisible=e}}},[t.showView?t._e():i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[i("el-form",{ref:"form",attrs:{"label-width":"80px"}},[i("scrm-form-item",{attrs:{itemLabel:"门店",itemType:"select",itemRequired:!0,itemClass:"form_required_after",subClass:"w-250",placeholder:"请选择门店",itemInfo:t.media,itemKey:"id",filterable:!0,selectOptions:t.shopOptions,optionLabel:"title",optionValue:"id",editable:"add"==t.dialogType,isTransfer:!0},on:{change:t.changeArea}}),t._v(" "),i("scrm-form-item",{staticClass:"add-item",attrs:{itemLabel:"垂媒账号",itemRequired:!0,itemClass:"form_required_after",itemInfo:{}}},[i("template",{slot:"custom"},[i("el-button",{staticClass:"m-b-20",attrs:{type:"primary",icon:"el-icon-plus",round:"",size:"small"},on:{click:t.addCount}},[t._v("新增垂媒账号")])],1)],2)],1),t._v(" "),i("el-form",{ref:"form",attrs:{"label-width":"80px"}},[i("table",{staticClass:"custom-table",attrs:{width:"100%",cellpadding:"0",cellspacing:"0",border:"0"}},t._l(t.mediaTable,function(e,a){return i("tr",{key:a,staticClass:"tr-item"},[i("td",{staticClass:"td-item",attrs:{width:"30%"}},[i("scrm-form-item",{attrs:{itemLabel:"垂媒"+(a+1),itemType:"select",itemRequired:!0,itemClass:"form_required_after",subClass:"w-100-percent",placeholder:"请选择垂媒",itemInfo:e,itemKey:"type",filterable:!0,selectOptions:e.options,optionLabel:"text",optionValue:"val"},on:{change:function(i){return t.selectChange(e)}}})],1),t._v(" "),i("td",{staticClass:"td-item",attrs:{width:"30%"}},[i("scrm-form-item",{attrs:{itemLabel:"账号",itemType:"input",itemRequired:!0,itemClass:"form_required_after",subClass:"w-100-percent",placeholder:"请输入",itemInfo:e,itemKey:"account_name"}})],1),t._v(" "),i("td",{staticClass:"td-item",attrs:{width:"30%"}},[i("scrm-form-item",{attrs:{itemLabel:"密码",itemType:"input",type:"password",itemRequired:!0,itemClass:"form_required_after",subClass:"w-100-percent",placeholder:"请输入",itemInfo:e,itemKey:"account_pwd"}})],1),t._v(" "),i("td",{staticClass:"td-item",attrs:{width:"10%"}},[a?i("i",{staticClass:"el-icon-delete m-l-15 pointer",on:{click:function(e){return t.deleteFn(a)}}}):t._e()])])}),0)])],1),t._v(" "),t.showView?i("div",{staticClass:"view"},[i("h3",{staticClass:"title m-b-20"},[t._v(t._s(t._f("filterBlank")(t.info.short_name)))]),t._v(" "),i("el-table",{staticStyle:{width:"100%"},attrs:{data:t.media.account,border:""}},[i("el-table-column",{attrs:{prop:"type_text",label:"垂媒",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("div",{staticClass:"media-wrap"},[i("span",{staticClass:"dot",class:[1==e.row.status?"green":"red"]}),t._v("\n                        "+t._s(e.row.type_text)+"\n                    ")])]}}],null,!1,1505534498)}),t._v(" "),i("el-table-column",{attrs:{prop:"account_name",label:"账号",align:"center"}}),t._v(" "),i("el-table-column",{attrs:{prop:"account_pwd",label:"密码",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",{staticStyle:{"font-size":"20px","font-weight":"700"}},[t._v(t._s(t._f("filterBlank")(t._f("changePwd")(e.row.account_pwd))))])]}}],null,!1,1919784761)})],1)],1):t._e(),t._v(" "),i("span",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{staticClass:"w-90",attrs:{round:"",size:"small"},on:{click:t.cancel}},[t._v("取 消")]),t._v(" "),i("el-button",{staticClass:"w-90",attrs:{round:"",size:"small",type:"primary"},on:{click:t.addFn}},[t._v(" "+t._s(t.btnName))])],1)])},staticRenderFns:[]};var p=i("VU/8")(d,h,!1,function(t){i("+QqN")},"data-v-3b019ba4",null).exports,u=i("PdD4"),m={components:{SearchBar:n.a,SearchCol:o.a,DataTable:l.a,AddMedia:p},mixins:[u.a],data:function(){return{showMedia:!1,showType:"add",mediaInfo:{}}},created:function(){this.initData(),this.queryData()},methods:{initData:function(){this.initSearch(),this.initTable(),this.initMediaOptions()},initSearch:function(){this.search={list:[{type:"select",label:"门店",currentVal:"",isAll:!0,isAllTitle:"全部",selectOptions:[],optionLabel:"title",optionValue:"id"},{type:"select",label:"垂媒",currentVal:"",isAll:!0,isAllTitle:"全部",selectOptions:[],optionLabel:"text",optionValue:"val"},{type:"select",label:"状态",currentVal:"",isAll:!0,isAllTitle:"全部",selectOptions:[],optionLabel:"text",optionValue:"val"},{type:"datePicker",label:"更新时间",currentVal:""}],shop:0,media:1,state:2,time:3}},initMediaOptions:function(){var t=this;this.$fetch.callCenter.mediaAccountOptions({}).then(function(e){t.$handleResponse(e,function(e){t.search.list[t.search.media].selectOptions=t.$hasArrContent(e.type)?e.type:[],t.search.list[t.search.state].selectOptions=t.$hasArrContent(e.status)?e.status:[]},!1)}),this.$fetch.common.commonAreaList({},!1).then(function(e){t.$handleResponse(e,function(e){t.$hasArrContent(e)&&(e.forEach(function(t){t.id=parseInt(t.id?t.id:0)}),t.search.list[t.search.shop].selectOptions=e)},!1)})},initTable:function(){this.dataTable={tr:[{id:"1",label:"门店",prop:"short_name",tooltip:!0,align:"center"},{id:"2",label:"垂媒",prop:"account",show:"template",tooltip:!0,align:"center"},{id:"3",label:"更新时间",prop:"last_update",tooltip:!0,align:"center"},{id:"4",label:"操作",prop:"caozuo",show:"template",minWidth:"130",align:"center"}],data:[],page:{totalCount:0,pageSize:20,currentPage:1},border:!0,hasSelect:!1,hasExpand:!1,hasFirstPagination:!1,search:{value:"",show:!1,width:"300",placeholder:"请输入手机号、客户微信",displayCol:["name","tel"],parma:{id:""}}}},getParams:function(){var t=this.dataTable.page,e=t.currentPage,i=t.pageSize,a=this.search,s=a.shop,n=a.media,o=a.state,l=a.time,c=a.list;return{area_id:c[s].currentVal,type:c[n].currentVal,status:c[o].currentVal,update_date_start:c[l].currentVal&&c[l].currentVal[0],update_date_end:c[l].currentVal&&c[l].currentVal[1],pre_page:i,page:e}},queryData:function(){var t=this,e=this,i=this.getParams();this.$fetch.callCenter.mediaAccountList(i).then(function(i){t.$handleResponse(i,function(t){e.dataTable.data=t.list?t.list:[],e.dataTable.page=t.page?t.page:e.dataTable.page},!0)}).catch(function(){t.$store.commit("closeLoading")})},deleteMedia:function(t){var e=this;this.$confirm("删除账号后，垂媒的线索无法同步至系统,是否确定要删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",customClass:"needCenterStyle mediaDeleteWidth",cancelButtonClass:"big cancel",confirmButtonClass:"big",roundButton:!0}).then(function(){e.$fetch.callCenter.mediaAccountDel({id:t.id}).then(function(t){e.$handleResponse(t,function(t){e.$message.success("删除成功"),e.queryData()},!0)}).catch(function(){e.$store.commit("closeLoading")})})},addFn:function(){this.showType="add",this.mediaInfo={},this.showMedia=!0},view:function(t){this.showType="view",this.mediaInfo=s()({},t),this.showMedia=!0},closeMedieFn:function(t){this.showMedia=!1,"success"==t&&this.queryData()}}},f={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"media-manage-page m-20 common-box"},[i("search-bar",{staticClass:"m-t-10 p-20",attrs:{size:"medium"},on:{clear:t.clear,find:t.find}},[i("div",{staticClass:"search-flex"},[i("search-col",{attrs:{info:t.search.list[t.search.shop],filterable:""}}),t._v(" "),i("search-col",{attrs:{info:t.search.list[t.search.media],filterable:""}}),t._v(" "),i("search-col",{attrs:{info:t.search.list[t.search.state]}}),t._v(" "),i("search-col",{attrs:{info:t.search.list[t.search.time],type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"}})],1)]),t._v(" "),i("div",{staticClass:"p-20"},[i("el-button",{staticClass:"m-b-20",attrs:{type:"primary",icon:"el-icon-plus",round:"",size:"small"},on:{click:t.addFn}},[t._v("新增垂媒账号")]),t._v(" "),i("data-table",{ref:"DataTableRef",attrs:{table:t.dataTable},on:{searchTable:t.searchTable,onHandleSelectionChange:t.handleSelectionChange},scopedSlots:t._u([{key:"account",fn:function(e){return t._l(e.obj.row.account,function(e,a){return i("div",{key:a,staticClass:"media-wrap"},[i("span",{staticClass:"dot",class:[1==e.status?"green":"red"]}),t._v("\n                    "+t._s(t._f("filterBlank")(e.type_text))+"\n                ")])})}},{key:"caozuo",fn:function(e){return[i("el-button",{staticClass:"blue_font_white_bg",attrs:{plain:"",round:"",size:"mini"},on:{click:function(i){return t.view(e.obj.row)}}},[t._v("查看详情")]),t._v(" "),i("el-button",{staticClass:"red_font_white_bg",attrs:{plain:"",round:"",size:"mini"},on:{click:function(i){return t.deleteMedia(e.obj.row)}}},[t._v("删除")])]}}])})],1),t._v(" "),t.showMedia?i("add-media",{attrs:{info:t.mediaInfo,type:t.showType,shopList:t.search.list[t.search.shop].selectOptions,mediaOptions:t.search.list[t.search.media].selectOptions},on:{close:t.closeMedieFn}}):t._e()],1)},staticRenderFns:[]};var b=i("VU/8")(m,f,!1,function(t){i("pzdM"),i("nu/J")},"data-v-2ce9d880",null);e.default=b.exports},"nu/J":function(t,e){},pzdM:function(t,e){}});
//# sourceMappingURL=18.883d34dd66ed7b8b29a6.js.map