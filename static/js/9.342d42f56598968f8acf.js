webpackJsonp([9],{NcvB:function(t,e){},PW83:function(t,e){},"Q/0S":function(t,e){},Rsvd:function(t,e){},Rt36:function(t,e){},g4hs:function(t,e){},nftH:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"org-structure-tree"},[n("el-input",{staticClass:"m-b-10",attrs:{placeholder:"请输入搜索内容"},model:{value:t.filterText,callback:function(e){t.filterText="string"==typeof e?e.trim():e},expression:"filterText"}}),t._v(" "),n("div",{staticClass:"custom-tree-node flex-1 flex"},[n("div",{staticClass:"flex-1 group-title  p-r-20"},[t._v(" 广汽集团 ")]),t._v(" "),n("div",{staticClass:"custom-tree-handle"},[n("el-dropdown",{staticClass:"group_dropdown",attrs:{placement:"right"}},[n("span",{staticClass:"el-dropdown-link"},[n("i",{staticClass:"el-icon-more el-icon--right"})]),t._v(" "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("div",{on:{click:function(e){return t.handleOrg("add",{id:0,name:"广汽集团"})}}},[n("el-dropdown-item",[t._v("新建子组织")])],1)])],1)],1)]),t._v(" "),n("el-tree",{ref:"orgTree",attrs:{data:t.orgData,props:t.defaultProps,"default-expanded-keys":t.expandKeys,"node-key":"id","expand-on-click-node":!1,"filter-node-method":t.filterNode,"icon-class":"el-icon-arrow-right"},on:{"node-expand":t.nodeExpandFn,"node-collapse":t.nodeCollapseFn,"node-click":t.handleNodeClick},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.node,i=e.data;return n("div",{staticClass:"custom-tree-node flex-1 flex"},[n("div",{staticClass:"tree-label",attrs:{title:a.label}},[t._v(t._s(a.label))]),t._v(" "),n("div",{staticClass:"custom-tree-handle"},[n("el-dropdown",{staticClass:"group_dropdown",attrs:{placement:"right"}},[n("span",{staticClass:"el-dropdown-link"},[n("i",{staticClass:"el-icon-more el-icon--right"})]),t._v(" "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("div",{on:{click:function(e){return t.handleOrg("add",i)}}},[n("el-dropdown-item",[t._v("新建子组织")])],1),t._v(" "),n("div",{on:{click:function(e){return t.handleOrg("edit",i,a)}}},[n("el-dropdown-item",[t._v("编辑")])],1),t._v(" "),n("div",{on:{click:function(e){return t.deleteOrg(i)}}},[n("el-dropdown-item",[t._v("删除")])],1)])],1)],1)])}}])})],1)},staticRenderFns:[]};var i=n("VU/8")({data:function(){return{filterText:"",orgData:[],defaultProps:{children:"child",label:"name"},expandKeys:[]}},created:function(){this.queryData()},watch:{filterText:function(t){this.$refs.orgTree.filter(t)}},methods:{handleNodeClick:function(t,e){this.$eventHub.$emit("changeCurrentOrg",t)},filterNode:function(t,e){return!t||-1!==e.name.toLowerCase().indexOf(t.toLowerCase())},queryData:function(){var t=this,e=this;this.$fetch.setting.queryOrgList({}).then(function(n){t.$handleResponse(n,function(a){e.orgData=n.data.data.orgStruct,e.$hasArrContent(e.orgData)&&(e.$eventHub.$emit("changeCurrentOrg",e.orgData[0]),t.$store.commit("closeLoading"))},!1)}).catch(function(){t.$store.commit("closeLoading")})},handleOrg:function(t,e,n){var a={id:"",parentId:e.id,parentName:e.name};if("edit"==t){var i=this.$isObj(n.parent.data);a.id=e.id,a.parentId=e.pid,a.parentName=i?n.parent.data.name:"广汽集团"}this.$router.push({path:"add"==t?"/setting/org-structure/add":"/setting/org-structure/edit",query:a})},deleteOrg:function(t){var e=this;this.$confirm("删除后会将此组织的子组织也一并删除，是否确定删除此组织?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",customClass:"needCenterStyle orgDeleteWidth",cancelButtonClass:"big cancel",confirmButtonClass:"big",roundButton:!0}).then(function(){e.orgDeleteFn(t)})},orgDeleteFn:function(t){var e=this;this.$fetch.setting.orgDelete(t.id).then(function(t){e.$handleResponse(t,function(t){e.$message.success("删除成功成功"),e.queryData()},!0)}).catch(function(){e.$store.commit("closeLoading")})},nodeExpandFn:function(t){this.expandKeys.push(t.id)},nodeCollapseFn:function(t){this.expandKeys=this.expandKeys.filter(function(e){return e!=t.id})}}},a,!1,function(t){n("Rt36"),n("Rsvd")},"data-v-abcd9254",null).exports,o=n("kZ4T"),s=n("IaGi"),r=n("ufHF"),c=n("PdD4"),l={props:{currentOrg:{type:Object,default:function(){return{}}}},components:{SearchCol:s.a,DataTable:r.a},mixins:[c.a],data:function(){return{}},created:function(){this.initData()},methods:{initData:function(){this.initTable(),this.initSearch()},initSearch:function(){this.search={list:[{type:"input",label:"门店名称",currentVal:""}],name:0}},initTable:function(){this.dataTable={tr:[{id:"1",label:"门店名称",prop:"short_name",align:"center"},{id:"2",label:"品牌",prop:"brandName",tooltip:!0,align:"center"}],data:[],page:{totalCount:0,pageSize:20,currentPage:1},border:!0,hasSelect:!1,hasExpand:!1,hasFirstPagination:!1,showScrollBar:!0,lastPageLayout:"sizes, prev, pager, next",search:{},hasOperation:!1,operation:[]}},getParams:function(){var t=this.dataTable.page,e=t.currentPage,n=t.pageSize,a=this.search,i=a.name,o=a.list;return{page:e,pageSize:n,orgId:this.currentOrg.id,name:o[i].currentVal,expand:"brands"}},queryData:function(t){var e=this,n=this,a=this.getParams();this.$fetch.setting.queryAreasList(a).then(function(t){e.$handleResponse(t,function(t){n.dataTable.data=t.list?t.list:[],n.dataTable.data.forEach(function(t){if(e.$hasArrContent(t.brands)){var n=[];t.brands.forEach(function(t){n.push(t.name)}),e.$set(t,"brandName",n.join("、"))}}),n.dataTable.page=t.page?t.page:n.dataTable.page,n.$emit("total",n.dataTable.page.totalCount)},!0)}).catch(function(t){e.$store.commit("closeLoading")})}}},d={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"manage-shop-component"},[n("div",{staticClass:"search-flex m-t-15"},[n("search-col",{staticClass:"export-log",attrs:{info:t.search.list[t.search.name],leftCol:6,rightCol:18,placeholder:"请输入"}}),t._v(" "),n("search-col",{staticClass:"export-log-btn",attrs:{leftCol:0,rightCol:24}},[n("div",{attrs:{slot:"custom"},slot:"custom"},[n("el-button",{staticClass:"m-l-20 w-110",attrs:{round:"",icon:"el-icon-search",size:"small",type:"primary"},on:{click:t.find}},[t._v("查询")]),t._v(" "),n("el-button",{attrs:{round:"",icon:"el-icon-delete",size:"small",plain:""},on:{click:t.clear}},[t._v("清空查询条件")])],1)])],1),t._v(" "),n("div",{staticClass:"p-l-r-20 p-b-20"},[n("data-table",{ref:"DataTableRef",attrs:{tableId:"manageShop",table:t.dataTable},on:{searchTable:t.searchTable}})],1)])},staticRenderFns:[]};var u=n("VU/8")(l,d,!1,function(t){n("Q/0S")},"data-v-25f25cd4",null).exports,h=n("//Fk"),f=n.n(h),p=n("kfhN"),g={props:{config:{type:Object,default:function(){return{type:"add",data:{}}}}},components:{ScrmFormItem:p.a},data:function(){return{title:"新增管理人员",dialogVisible:!0,info:{adminId:"",account:"",roleId:""},userOptions:[],roleOptions:[],isLoading:!1}},created:function(){if("edit"==this.config.type){this.title="编辑管理人员";var t=this.config.data,e=t.id,n=t.account,a=t.orgRole;this.info.adminId=e,this.info.account=n,this.info.roleId=a&&a.id}this.userObj={},this.getAdminsList()},computed:{userDisabled:function(){return"edit"==this.config.type}},methods:{getAdmins:function(){var t=this,e={expand:"orgRole",orgId:this.config.org&&this.config.org.id,pagination:0};this.isLoading=!0,f.a.all([this.$fetch.setting.queryAccountList(e,!1,!1),this.$fetch.setting.queryAccountList({expand:"roles",filterRoleKey:"dcc",pagination:0},!1,!1)]).then(function(e){t.isLoading=!1;var n=[];t.$handleResponse(e[0],function(e){e&&e.list&&e.list.length&&e.list.forEach(function(e){"edit"==t.config.type&&e.id!==t.config.data.id?n.push(e.id):"add"==t.config.type&&n.push(e.id)})},!1),t.$handleResponse(e[1],function(e){var a=t.$hasArrContent(e.list)?e.list:[],i=[];t.$hasArrContent(n)&&a.forEach(function(e){-1==n.indexOf(e.id)&&(i.push(e),t.userObj[e.id]=e)}),t.userOptions=i,"edit"==t.config.type&&(t.roleOptions=t.$hasArrContent(t.userObj[t.config.data.id].roles)?t.userObj[t.config.data.id].roles:[])},!1)}).catch(function(){t.isLoading=!1,t.$store.commit("closeLoading")})},getAdminsList:function(){var t=this;this.isLoading=!0,this.$fetch.setting.queryAccountList({expand:"roles",pagination:0},!1,!1).then(function(e){t.isLoading=!1,t.$handleResponse(e,function(e){t.userOptions=t.$hasArrContent(e.list)?e.list:[],t.userOptions.forEach(function(e){t.userObj[e.id]=e}),"edit"==t.config.type&&(t.roleOptions=t.$hasArrContent(t.userObj[t.config.data.id].roles)?t.userObj[t.config.data.id].roles:[],t.roleOptions=t.roleOptions.filter(function(t){return-1==["dcc_inviter","dcc_supervisor","dcc_group_leader"].indexOf(t.role_key)}))},!1)}).catch(function(e){t.isLoading=!1,t.$store.commit("closeLoading")})},getParams:function(){var t=this.info,e=t.adminId,n=t.roleId;return e?n?{adminId:e,roleId:n}:(this.$message.error("角色不能为空"),!1):(this.$message.error("管理人员不能为空"),!1)},addManager:function(){var t=this.getParams();t&&("add"==this.config.type?this.createFn(t):this.updateFn(t))},createFn:function(t){var e=this;this.isLoading=!0,this.$fetch.setting.adminCreate(this.config.org.id,t).then(function(t){e.isLoading=!1,e.$handleResponse(t,function(t){e.$message.success("新增成功"),e.$emit("close","success")},!0)}).catch(function(t){e.isLoading=!1,e.$store.commit("closeLoading")})},updateFn:function(t){var e=this;this.isLoading=!0,this.$fetch.setting.adminUpdate(this.config.org.id,this.info.adminId,t).then(function(t){e.isLoading=!1,e.$handleResponse(t,function(t){e.$message.success("更新成功"),e.$emit("close","success")},!0)}).catch(function(t){e.isLoading=!1,e.$store.commit("closeLoading")})},cancel:function(){this.$emit("close","cancel")},changeUser:function(t){this.info.account=this.userObj[t].account,this.info.roleId="",this.roleOptions=this.$hasArrContent(this.userObj[t].roles)?this.userObj[t].roles:[],this.roleOptions=this.roleOptions.filter(function(t){return-1==["dcc_inviter","dcc_supervisor","dcc_group_leader"].indexOf(t.role_key)})}}},m={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-dialog",{staticClass:"add-man-people-dialog",attrs:{title:t.title,visible:t.dialogVisible,width:"510px",appentToBody:"","close-on-click-modal":!1,"before-close":t.cancel},on:{"update:visible":function(e){t.dialogVisible=e}}},[n("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.isLoading,expression:"isLoading"}],ref:"form",attrs:{"label-width":"110px"}},[n("el-form-item",{attrs:{label:"当前组织"}},[t._v("\n            "+t._s(t.config.org&&t.config.org.name)+"\n        ")]),t._v(" "),n("scrm-form-item",{attrs:{itemLabel:"选择管理人员",itemType:"select",itemRequired:!0,itemClass:"form_required_after",subClass:"w-100-percent",placeholder:"请选择",itemInfo:t.info,itemKey:"adminId",filterable:!0,selectOptions:t.userOptions,optionLabel:"nickname",optionValue:"id",disabled:t.userDisabled},on:{change:t.changeUser}}),t._v(" "),n("scrm-form-item",{attrs:{itemLabel:"账号",itemType:"input",itemRequired:!0,itemClass:"form_required_after",subClass:"w-100-percent",itemInfo:t.info,itemKey:"account",placeholder:"请输入内容",disabled:""}}),t._v(" "),n("scrm-form-item",{attrs:{itemLabel:"角色",itemType:"select",itemRequired:!0,itemClass:"form_required_after",subClass:"w-100-percent",placeholder:"请选择",itemInfo:t.info,itemKey:"roleId",filterable:!0,selectOptions:t.roleOptions,optionLabel:"name",optionValue:"id"}})],1),t._v(" "),n("span",{attrs:{slot:"footer"},slot:"footer"},[n("el-button",{staticClass:"w-90",attrs:{round:"",size:"small"},on:{click:t.cancel}},[t._v("取 消")]),t._v(" "),n("el-button",{staticClass:"w-90",attrs:{round:"",size:"small",type:"primary",disabled:t.isLoading},on:{click:t.addManager}},[t._v("保存")])],1)],1)},staticRenderFns:[]};var b=n("VU/8")(g,m,!1,function(t){n("g4hs")},"data-v-cf6c2bdc",null).exports,v={components:{SearchCol:s.a,DataTable:r.a,AddManagePeople:b},props:{currentOrg:{type:Object,default:function(){return{}}}},mixins:[c.a],data:function(){return{showAdd:!1,rowConfig:{}}},created:function(){this.initData()},methods:{initData:function(){this.initSearch(),this.initTable()},initSearch:function(){this.search={list:[{type:"input",label:"姓名/账号",currentVal:""}],keyword:0}},initTable:function(){this.dataTable={tr:[{id:"1",label:"姓名",prop:"nickname",align:"center"},{id:"2",label:"账号",prop:"account",tooltip:!0,align:"center"},{id:"3",label:"角色",prop:"orgRole",show:"template",tooltip:!0,align:"center"},{id:"4",label:"操作",prop:"caozuo",show:"template",align:"center"}],data:[],page:{totalCount:0,pageSize:20,currentPage:1},border:!0,hasSelect:!0,hasExpand:!1,hasFirstPagination:!0,showScrollBar:!0,lastPageLayout:"sizes, prev, pager, next",search:{},hasOperation:!1,operation:[]}},getParams:function(){var t=this.dataTable.page,e=t.currentPage,n=t.pageSize,a=this.search,i=a.keyword;return{expand:"orgRole",keyword:a.list[i].currentVal,orgId:this.currentOrg.id,pageSize:n,page:e}},queryData:function(){var t=this,e=this,n=this.getParams();this.$fetch.setting.queryAccountList(n).then(function(n){t.$handleResponse(n,function(t){e.dataTable.data=t.list?t.list:[],e.dataTable.page=t.page?t.page:e.dataTable.page,e.$emit("total",e.dataTable.page.totalCount)},!0)}).catch(function(){t.$store.commit("closeLoading")})},deleteFn:function(t,e){var n=this;if(!this.$hasArrContent(this.selectData)&&"batch"==t)return this.$message.warning("您还没有选中要删除的管理人员"),!1;var a="batch"==t?"您确定要删除选中的管理人员吗?":"是否确定删除此管理人员?";this.$confirm(a,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",customClass:"needCenterStyle",cancelButtonClass:"big cancel",confirmButtonClass:"big",roundButton:!0}).then(function(){var a=[];"batch"==t?n.selectData.forEach(function(t){a.push(t.id)}):a.push(e.id),n.orgAdminDelete(a)})},orgAdminDelete:function(t){var e=this;this.$fetch.setting.adminDelete(this.currentOrg.id,t.join(",")).then(function(t){e.$handleResponse(t,function(t){e.$message.success("删除成功!"),e.queryData()},!0)}).catch(function(){e.$store.commit("closeLoading")})},handleFn:function(t,e){this.rowConfig.type=t,this.rowConfig.data=e,this.rowConfig.org=this.currentOrg,this.showAdd=!0},closeDialog:function(t){this.showAdd=!1,"success"==t&&this.queryData()}}},_={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"manage-people-componnet"},[n("div",{staticClass:"search-flex"},[n("search-col",{staticClass:"export-log",attrs:{info:t.search.list[t.search.keyword],leftCol:6,rightCol:18,placeholder:"请输入"}}),t._v(" "),n("search-col",{staticClass:"export-log-btn",attrs:{leftCol:0,rightCol:24}},[n("div",{attrs:{slot:"custom"},slot:"custom"},[n("el-button",{staticClass:"m-l-20 w-110",attrs:{round:"",icon:"el-icon-search",size:"small",type:"primary"},on:{click:t.find}},[t._v("查询")]),t._v(" "),n("el-button",{attrs:{round:"",icon:"el-icon-delete",size:"small",plain:""},on:{click:t.clear}},[t._v("清空查询条件")])],1)])],1),t._v(" "),n("div",{staticClass:"p-l-r-20 p-b-20"},[n("data-table",{ref:"DataTableRef",attrs:{tableId:"managePeople",table:t.dataTable},on:{searchTable:t.searchTable,onHandleSelectionChange:t.handleSelectionChange},scopedSlots:t._u([{key:"orgRole",fn:function(e){return[t._v("\n                "+t._s(t._f("filterBlank")(e.obj.row.orgRole.name))+"\n            ")]}},{key:"caozuo",fn:function(e){return[n("el-button",{staticClass:"blue_font_white_bg",attrs:{plain:"",round:"",size:"mini"},on:{click:function(n){return t.handleFn("edit",e.obj.row)}}},[t._v("编辑")]),t._v(" "),n("el-button",{staticClass:"red_font_white_bg",attrs:{plain:"",round:"",size:"mini"},on:{click:function(n){return t.deleteFn("one",e.obj.row)}}},[t._v("删除")])]}}])},[n("div",{attrs:{slot:"buttons"},slot:"buttons"},[n("el-button",{attrs:{type:"primary",round:"",size:"small"},on:{click:function(e){return t.handleFn("add",{})}}},[t._v("新增管理人员")]),t._v(" "),n("el-button",{staticClass:"w-90",attrs:{plain:"",size:"small",round:""},on:{click:function(e){return t.deleteFn("batch",{})}}},[t._v("删除")])],1)])],1),t._v(" "),t.showAdd?n("add-manage-people",{attrs:{config:t.rowConfig},on:{close:t.closeDialog}}):t._e()],1)},staticRenderFns:[]};var C=n("VU/8")(v,_,!1,function(t){n("PW83")},"data-v-314cf15f",null).exports,$={components:{TabsScrm:o.a,ManageShop:u,ManagePeople:C},data:function(){return{currentOrg:{},tabs:[{title:"管理门店",name:"shop",count:0},{title:"管理人员",name:"people",count:0}],activedTab:"shop"}},mounted:function(){var t=this;this.$eventHub.$on("changeCurrentOrg",function(e){t.currentOrg=e,t.$nextTick(function(){t.$refs.shop&&t.$refs.shop.clear(),t.$refs.people&&t.$refs.people.clear()})})},methods:{changeTab:function(t){this.activedTab=t},totalPeople:function(t){this.tabs[1].count=t},totalShop:function(t){this.tabs[0].count=t}}},y={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"org-manage-shop"},[n("div",{staticClass:"org-title"},[t._v(" 当前组织:  "+t._s(t._f("filterBlank")(t.currentOrg.name)))]),t._v(" "),n("tabs-scrm",{staticClass:"org-tab",attrs:{tabs:t.tabs,tabStyle:{height:"3px",line:"bottom"}},on:{change:t.changeTab}}),t._v(" "),n("manage-shop",{directives:[{name:"show",rawName:"v-show",value:"shop"==t.activedTab,expression:"activedTab=='shop'"}],ref:"shop",attrs:{currentOrg:t.currentOrg},on:{total:t.totalShop}}),t._v(" "),n("manage-people",{directives:[{name:"show",rawName:"v-show",value:"people"==t.activedTab,expression:"activedTab=='people'"}],ref:"people",attrs:{currentOrg:t.currentOrg},on:{total:t.totalPeople}})],1)},staticRenderFns:[]};var w={components:{LeftTree:i,RightContent:n("VU/8")($,y,!1,function(t){n("yhaD")},"data-v-5d8c7f97",null).exports},data:function(){return{}}},x={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"setting-org-structure-page m-20 common-box min-h-600"},[e("div",{staticClass:"group-title"},[this._v("组织架构设置")]),this._v(" "),e("left-tree",{staticClass:"left-tree"}),this._v(" "),e("right-content",{staticClass:"right-content"})],1)},staticRenderFns:[]};var O=n("VU/8")(w,x,!1,function(t){n("NcvB")},"data-v-51d7dbf0",null);e.default=O.exports},yhaD:function(t,e){}});
//# sourceMappingURL=9.342d42f56598968f8acf.js.map