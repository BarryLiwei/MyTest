webpackJsonp([15],{"7IuR":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("/Uby"),n=i("IaGi"),o=i("ufHF"),s=i("PdD4"),r=i("fZjL"),l=i.n(r),c=i("kfhN"),d=i("PJh5"),f=i.n(d),u={props:{rowInfo:{type:Object,default:function(){return{}}}},components:{ScrmFormItem:c.a},data:function(){return{loading:!1,dialogVisible:!0,title:"新增活动",type:"add",info:{type:"",brandId:"",areaId:[],title:"",content:"",time:[]},checked:!1,optionsInfo:{type:[],brand:[],area:[]},minTime:f()(new Date).subtract(1,"day")}},created:function(){l()(this.rowInfo).length&&(this.title="编辑活动",this.type="edit",this.taskView()),this.initTypeOptions()},methods:{initTypeOptions:function(){this.optionsInfo.type=[{id:2,title:"集团活动"},{id:3,title:"品牌活动"},{id:4,title:"其他活动"}]},taskView:function(){var e=this;this.$fetch.callCenter.activityView({id:this.rowInfo.id}).then(function(t){e.$handleResponse(t,function(t){var i=t;e.info.type=i.activityType,i.endDate&&(e.info.time.length=0,e.info.time.push(i.startDate),e.info.time.push(i.endDate)),e.typeChange(),e.info.areaId=[],i.areas.forEach(function(t){e.info.areaId.push(t.id)}),e.info.brandId=i.brandId,e.info.title=i.title,e.info.content=i.content},!0)}).catch(function(){e.$store.commit("closeLoading")})},cancel:function(){this.$emit("close","cancel")},getParmam:function(){var e=this.info,t=e.type,i=e.brandId,a=e.areaId,n=e.title,o=e.content,s=e.time;if(!s.length)return this.$message.error("有效期未填写，请完成填写再提交"),!1;if(!t)return this.$message.error("活动类型未填写，请完成填写再提交"),!1;if(t&&3==t&&!i)return this.$message.error("品牌未填写，请完成填写再提交"),!1;if(t&&4==t&&!a.length)return this.$message.error("适用门店未填写，请完成填写再提交"),!1;if(!n)return this.$message.error("活动标题未填写，请完成填写再提交"),!1;if(!o)return this.$message.error("内容未填写，请完成填写再提交"),!1;var r={type:t,title:n,content:o,startDate:s&&s[0],endDate:s&&s[1]};return 3==r.type?r.brandId=i:4==r.type&&(r.areaId=a),r},addFn:function(){var e=this,t=this.getParmam();t&&("add"==this.type?this.$fetch.callCenter.activityCreate(t).then(function(t){e.$handleResponse(t,function(t){e.$message.success("新增成功"),e.$emit("close","success")},!0)}).catch(function(){e.$store.commit("closeLoading")}):(t.id=this.rowInfo.id,this.$fetch.callCenter.activityUpdate(t).then(function(t){e.$handleResponse(t,function(t){e.$message.success("编辑成功"),e.$emit("close","success")},!0)}).catch(function(){e.$store.commit("closeLoading")})))},typeChange:function(){3==this.info.type?this.initBrandOptions():4==this.info.type&&this.initAreaOptions()},initBrandOptions:function(){var e=this;this.$fetch.common.carBrand({}).then(function(t){e.$handleResponse(t,function(t){e.optionsInfo.brand=t},!0)}).catch(function(){e.$store.commit("closeLoading")})},initAreaOptions:function(){var e=this;this.$fetch.common.commonAreaList({}).then(function(t){e.$handleResponse(t,function(t){e.optionsInfo.area=t},!0)}).catch(function(){e.$store.commit("closeLoading")})}}},m={render:function(){var e=this,t=this,i=t.$createElement,a=t._self._c||i;return a("el-dialog",{staticClass:"add-talk-task-dialog",attrs:{title:t.title,visible:t.dialogVisible,width:"650px",appentToBody:"","close-on-click-modal":!1,"before-close":t.cancel},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",attrs:{"label-width":"110px"}},[a("scrm-form-item",{staticClass:"form-task-time",attrs:{itemInfo:t.info,itemKey:"time",itemLabel:"有效期",itemRequired:!0,itemClass:"form_required_after",itemType:"datePicker",subClass:"w-400",type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd",disabled:t.checked,"picker-options":{disabledDate:function(t){return t<new Date(e.minTime).getTime()}}}}),t._v(" "),a("scrm-form-item",{attrs:{itemInfo:t.info,itemKey:"type",itemLabel:"活动类型",itemRequired:!0,itemClass:"form_required_after",itemType:"select",subClass:"w-400",placeholder:"请选择",filterable:!0,selectOptions:t.optionsInfo.type,optionLabel:"title",optionValue:"id"},on:{change:function(e){return t.typeChange()}}}),t._v(" "),a("scrm-form-item",{directives:[{name:"show",rawName:"v-show",value:3==t.info.type,expression:"info.type == 3"}],attrs:{itemInfo:t.info,itemKey:"brandId",itemLabel:"适用品牌",itemRequired:!0,itemClass:"form_required_after",itemType:"select",subClass:"w-400",placeholder:"请选择",filterable:!0,selectOptions:t.optionsInfo.brand,optionLabel:"title",optionValue:"id"}}),t._v(" "),a("scrm-form-item",{directives:[{name:"show",rawName:"v-show",value:4==t.info.type,expression:"info.type == 4"}],attrs:{itemInfo:t.info,itemKey:"areaId",itemLabel:"适用门店",itemRequired:!0,itemClass:"form_required_after",itemType:"select",multiple:"",subClass:"w-400",placeholder:"请选择",filterable:!0,selectOptions:t.optionsInfo.area,optionLabel:"title",optionValue:"id"}}),t._v(" "),t.info.type?a("scrm-form-item",{attrs:{itemInfo:t.info,itemKey:"title",itemLabel:"活动标题",itemRequired:!0,itemClass:"form_required_after",itemType:"input",subClass:"w-400",maxlength:"20",placeholder:"20个字符以内"}}):t._e(),t._v(" "),t.info.type?a("scrm-form-item",{attrs:{itemInfo:t.info,itemKey:"content",itemLabel:"内容",itemRequired:!0,itemClass:"form_required_after",itemType:"input",type:"textarea",autosize:{minRows:4},subClass:"w-400",maxlength:"500",placeholder:"请输入活动内容","show-word-limit":""}}):t._e()],1),t._v(" "),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"w-90",attrs:{round:"",size:"small"},on:{click:t.cancel}},[t._v("取 消")]),t._v(" "),a("el-button",{staticClass:"w-90",attrs:{round:"",size:"small",type:"primary"},on:{click:t.addFn}},[t._v("确 定")])],1)],1)},staticRenderFns:[]};var p=i("VU/8")(u,m,!1,function(e){i("d1ge"),i("bdR5")},"data-v-4b690880",null).exports,h={components:{ScrmFormItem:c.a},props:{id:{type:[String,Number],default:""}},data:function(){return{dialogVisible:!0,checked:!0,loading:!1,viewInfo:{}}},created:function(){this.taskView()},methods:{cancel:function(){this.$emit("cancel")},taskView:function(){var e=this;this.$fetch.callCenter.activityView({id:this.id}).then(function(t){e.$handleResponse(t,function(t){e.viewInfo=t,e.viewInfo.areasName=[],t.areas.forEach(function(t){e.viewInfo.areasName.push(t.areaName)}),e.viewInfo.areasLength=e.viewInfo.areasName.length},!0)}).catch(function(){e.$store.commit("closeLoading")})}}},v={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{staticClass:"view-talk-task-dialog",attrs:{title:"活动详情",visible:e.dialogVisible,width:"500px",appentToBody:"","close-on-click-modal":!1,"before-close":e.cancel},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{"label-width":"110px"}},[i("scrm-form-item",{attrs:{itemLabel:"有效期",itemType:"input",itemInfo:{},editable:!1}},[i("template",{slot:"notEdit"},[e._v("\n                 "+e._s(e.viewInfo.startDate)+" 至 "+e._s(e.viewInfo.endDate)+"\n            ")])],2),e._v(" "),i("scrm-form-item",{attrs:{itemLabel:"活动类型",itemType:"input",itemInfo:e.viewInfo,itemKey:"activityTypeTitle",editable:!1}}),e._v(" "),i("scrm-form-item",{directives:[{name:"show",rawName:"v-show",value:3==e.viewInfo.activityType,expression:"viewInfo.activityType == 3"}],attrs:{itemLabel:"适用品牌",itemType:"input",itemInfo:e.viewInfo,itemKey:"brand",editable:!1}}),e._v(" "),i("scrm-form-item",{directives:[{name:"show",rawName:"v-show",value:4==e.viewInfo.activityType,expression:"viewInfo.activityType == 4"}],attrs:{itemLabel:"适用门店("+e.viewInfo.areasLength+")",itemType:"input",itemInfo:{},editable:!1}},[i("template",{slot:"notEdit"},e._l(e.viewInfo.areasName,function(t,a){return i("span",{key:a},[0!=a?i("i",[e._v("、")]):e._e(),e._v(e._s(t))])}),0)],2),e._v(" "),i("scrm-form-item",{attrs:{itemLabel:"活动标题",itemType:"input",itemInfo:e.viewInfo,itemKey:"title",editable:!1}}),e._v(" "),i("scrm-form-item",{attrs:{itemLabel:"内容",itemType:"input",itemInfo:e.viewInfo,itemKey:"content",editable:!1,isEllipsis:!1}})],1)],1)},staticRenderFns:[]};var y=i("VU/8")(h,v,!1,function(e){i("KzAw")},"data-v-74ff11b1",null).exports,b={components:{SearchBar:a.a,SearchCol:n.a,DataTable:o.a,AddActivity:p,ViewActivity:y},mixins:[s.a],data:function(){return{showAdd:!1,showView:!1,currentRow:{}}},created:function(){this.initData(),this.queryData()},methods:{initData:function(){this.initSearch(),this.initTable(),this.getAreaOptions()},initSearch:function(){this.search={list:[{prop:"area",type:"select",label:"归属门店",currentVal:"",isAll:!0,isAllTitle:"全部",selectOptions:[],optionLabel:"title",optionValue:"id"},{prop:"type",type:"select",label:"活动类型",currentVal:"",isAll:!0,isAllTitle:"全部",selectOptions:[{id:1,title:"门店活动"},{id:2,title:"集团活动"},{id:3,title:"品牌活动"},{id:4,title:"其他活动"}],optionLabel:"title",optionValue:"id"},{prop:"createDate",type:"datePicker",label:"创建时间",currentVal:""},{prop:"validDate",type:"datePicker",label:"有效期",currentVal:""}],area:0,type:1,createDate:2,validDate:3}},initTable:function(){this.dataTable={tr:[{id:"1",label:"任务ID",prop:"longId",tooltip:!0},{id:"2",label:"适用门店",prop:"areaOverview",tooltip:!0,minWidth:"150"},{id:"3",label:"活动类型",prop:"activityTypeTitle",tooltip:!0,minWidth:"100"},{id:"4",label:"活动标题",prop:"title",tooltip:!0,minWidth:"110"},{id:"5",label:"有效期",prop:"startDate",show:"template",tooltip:!0,minWidth:"185"},{id:"6",label:"创建时间",prop:"createdDate",tooltip:!0,minWidth:"150"},{id:"7",label:"操作选项",prop:"caozuo",show:"template",width:"250"}],data:[],page:{totalCount:0,pageSize:20,currentPage:1},border:!0,hasSelect:!0,hasExpand:!1,hasFirstPagination:!0,showScrollBar:!0,search:{value:"",show:!0,url:"callCenter.activityList",width:"300",placeholder:"请输入活动ID/活动标题",displayCol:["longId","title"],params:{id:""},keyword:"kwd"}}},getParams:function(){var e=this.dataTable.page,t=e.currentPage,i=e.pageSize,a=this.search,n=a.area,o=a.type,s=a.createDate,r=a.validDate,l=a.list;return{area:l[n].currentVal,type:l[o].currentVal,createDateStart:l[s].currentVal&&l[s].currentVal[0],createDateEnd:l[s].currentVal&&l[s].currentVal[1],validDateStart:l[r].currentVal&&l[r].currentVal[0],validDateEnd:l[r].currentVal&&l[r].currentVal[1],pageSize:i,page:t}},queryData:function(){var e=this,t=this,i=this.getParams();this.$fetch.callCenter.activityList(i,!0).then(function(i){e.$handleResponse(i,function(e){t.dataTable.data=e.list?e.list:[],t.dataTable.page=e.page?e.page:t.dataTable.page},!0)}).catch(function(){e.$store.commit("closeLoading")})},batchDelete:function(){var e=this;console.log(this.selectData),this.$hasArrContent(this.selectData)?this.$confirm("您确定要删除选中的活动吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",customClass:"needCenterStyle",cancelButtonClass:"big cancel",confirmButtonClass:"big",roundButton:!0}).then(function(){var t=[];e.selectData.forEach(function(e){t.push(e.id)}),e.$fetch.callCenter.activityDelete({id:t}).then(function(t){e.$handleResponse(t,function(t){e.$message.success("删除成功"),e.queryData()},!0)}).catch(function(){e.$store.commit("closeLoading")})}):this.$message.warning("您还没选择活动")},deleteFn:function(e){var t=this;this.$confirm("删除后不可恢复，是否确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",customClass:"needCenterStyle",cancelButtonClass:"big cancel",confirmButtonClass:"big",roundButton:!0}).then(function(){t.$fetch.callCenter.activityDelete({id:[e.id]}).then(function(e){t.$handleResponse(e,function(e){t.$message.success("删除成功"),t.queryData()},!0)}).catch(function(){t.$store.commit("closeLoading")})})},viewFn:function(e){this.currentRow=e,this.showView=!0},HandleFn:function(e,t){this.currentRow=t,this.showAdd=!0},closeShowAdd:function(){this.showAdd=!1,this.queryData()}}},w={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"activity-page m-20 common-box"},[i("search-bar",{staticClass:"m-t-10 p-20",attrs:{size:"medium"},on:{clear:e.clear,find:e.find}},[i("div",{staticClass:"search-flex"},[i("search-col",{attrs:{info:e.search.list[e.search.area],leftCol:8,filterable:""}}),e._v(" "),i("search-col",{attrs:{info:e.search.list[e.search.type]}}),e._v(" "),i("search-col",{attrs:{info:e.search.list[e.search.createDate],leftCol:8,type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"}}),e._v(" "),i("search-col",{attrs:{info:e.search.list[e.search.validDate],leftCol:8,type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"}})],1)]),e._v(" "),i("div",{staticClass:"p-l-r-20 p-b-20"},[i("data-table",{ref:"DataTableRef",attrs:{table:e.dataTable},on:{searchTable:e.searchTable,onHandleSelectionChange:e.handleSelectionChange},scopedSlots:e._u([{key:"caozuo",fn:function(t){return[i("el-button",{staticClass:"blue_font_white_bg",attrs:{plain:"",round:"",size:"mini"},on:{click:function(i){return e.viewFn(t.obj.row)}}},[e._v("查看")]),e._v(" "),1!=t.obj.row.activityType?i("el-button",{staticClass:"blue_font_white_bg",attrs:{plain:"",round:"",size:"mini"},on:{click:function(i){return e.HandleFn("edit",t.obj.row)}}},[e._v("编辑")]):e._e(),e._v(" "),1!=t.obj.row.activityType?i("el-button",{staticClass:"red_font_white_bg",attrs:{plain:"",round:"",size:"mini"},on:{click:function(i){return e.deleteFn(t.obj.row)}}},[e._v("删除")]):e._e()]}},{key:"startDate",fn:function(t){return[i("div",[e._v("\n                    "+e._s(t.obj.row.startDate)+" 至 "+e._s(t.obj.row.endDate)+"\n                ")])]}}])},[i("div",{attrs:{slot:"buttons"},slot:"buttons"},[i("el-button",{attrs:{type:"primary",icon:"el-icon-plus",round:"",size:"small"},on:{click:function(t){return e.HandleFn("add",{})}}},[e._v("新增活动")]),e._v(" "),i("el-button",{staticClass:"w-90",attrs:{plain:"",size:"small",round:""},on:{click:e.batchDelete}},[e._v("删除")])],1)])],1),e._v(" "),e.showAdd?i("add-activity",{attrs:{rowInfo:e.currentRow},on:{close:e.closeShowAdd}}):e._e(),e._v(" "),e.showView?i("view-activity",{attrs:{id:e.currentRow.id},on:{cancel:function(t){e.showView=!1}}}):e._e()],1)},staticRenderFns:[]};var g=i("VU/8")(b,w,!1,function(e){i("up2u")},"data-v-412a4452",null);t.default=g.exports},KzAw:function(e,t){},bdR5:function(e,t){},d1ge:function(e,t){},up2u:function(e,t){}});
//# sourceMappingURL=15.67de39db166a9f541384.js.map