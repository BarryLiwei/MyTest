webpackJsonp([14],{"90Ox":function(t,e){},XIDU:function(t,e){},ZYrh:function(t,e){},mX30:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n("/Uby"),a=n("IaGi"),o=n("ufHF"),s=n("mvHQ"),r=n.n(s),c=n("woOf"),l=n.n(c),d=n("fZjL"),u=n.n(d),f=n("kfhN"),m=n("PJh5"),p=n.n(m),h=n("oFuF"),b={props:{rowInfo:{type:Object,default:function(){return{}}}},components:{ScrmFormItem:f.a},data:function(){return{loading:!1,dialogVisible:!0,title:"新增开口任务",type:"add",info:{scenario:"",title:"",content:[{title:""}],dccGroup:[],startDate:"",endDate:""},checked:!1,optionsInfo:{},defaultStartDate:"00:00:00"}},created:function(){this.lastSelectLength=0,u()(this.rowInfo).length&&(this.title="编辑开口任务",this.type="edit"),this.initOptions()},methods:{dataFocus:function(){this.defaultStartDate=p()(new Date).format("HH:mm:ss")},initOptions:function(){var t=this;this.loading=!0,this.$fetch.callCenter.openTaskInitOptions({}).then(function(e){t.optionsInfo=e.data.data,t.loading=!1,"edit"==t.type&&t.taskView()}).catch(function(){t.loading=!1,"edit"==t.type&&t.taskView()})},taskView:function(){var t=this;this.loading=!0,this.$fetch.callCenter.openTaskView({id:this.rowInfo.id}).then(function(e){var n=e.data.data,i=[];t.$hasArrContent(n.dccGroup)&&n.dccGroup.forEach(function(t){i.push(t.id)}),l()(t.info,n),t.info.dccGroup=i,t.changeGroup(t.info.dccGroup),"永久有效"==n.endDate&&(t.checked=!0,t.info.endDate=""),t.loading=!1}).catch(function(){t.loading=!1})},cancel:function(){this.$emit("close","cancel")},addContent:function(){this.info.content&&this.info.content.length<8?this.info.content.push({title:""}):this.$message.warning("任务内容最多添加8个")},upBtn:function(t){var e=JSON.parse(r()(this.info.content[t-1]));l()(this.info.content[t-1],this.info.content[t]),l()(this.info.content[t],e)},downBtn:function(t,e){var n=JSON.parse(r()(this.info.content[t+1]));l()(this.info.content[t+1],this.info.content[t]),l()(this.info.content[t],n)},deleteBtn:function(t){this.info.content.splice(t,1)},limitTimechange:function(t){t&&(this.info.endDate="")},getParmam:function(){var t=this.info,e=t.scenario,n=t.title,i=t.content,a=(t.dccGroup,t.dccGroupIds),o=t.startDate,s=t.endDate;if(!e)return this.$message.error("适用场景必填"),!1;if(!n)return this.$message.error("任务名称必填"),!1;for(var r=0,c=i.length;r<c;r++)if(!i[r].title)return this.$message.error("第"+(r+1)+"行任务内容必填"),!1;if(!a.length)return this.$message.error("适用坐席组必填"),!1;if(!o)return this.$message.error("任务开始时间必填"),!1;if(!this.checked&&!s)return this.$message.error("任务结束时间必填"),!1;var l={scenario:e,title:n,content:i,dccGroup:a,startDate:o,endDate:s};return this.checked&&(l.endDate=0),l},addFn:function(t){var e=this,n=this.getParmam();n&&("online"==t&&(n.status=1),this.loading=!0,"add"==this.type?this.$fetch.callCenter.openTaskCreate(n,!0,!1).then(function(t){e.loading=!1,e.$handleResponse(t,function(t){e.$message.success("新增成功"),e.$emit("close","success")},!1)}).catch(function(){e.loading=!1}):(n.id=this.rowInfo.id,this.$fetch.callCenter.openTaskUpdate(n,!0,!1).then(function(t){e.loading=!1,e.$handleResponse(t,function(t){e.$message.success("编辑成功"),e.$emit("close","success")},!0)}).catch(function(){e.loading=!1})))},changeGroup:function(t){var e=Object(h.b)(t,this.optionsInfo.dccGroup,"id","title",this.lastSelectLength);this.info.dccGroup=e.selectIds,this.info.dccGroupIds=e.resultIds,this.lastSelectLength=e.lastSelectLength}}},v={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-dialog",{staticClass:"add-talk-task-dialog",attrs:{title:t.title,visible:t.dialogVisible,"custom-class":"dialog-width",appentToBody:"","close-on-click-modal":!1,"before-close":t.cancel},on:{"update:visible":function(e){t.dialogVisible=e}}},[n("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",attrs:{"label-width":"110px"}},[n("scrm-form-item",{attrs:{itemInfo:t.info,itemKey:"scenario",itemLabel:"适用场景",itemRequired:!0,itemClass:"form_required_after",itemType:"select",subClass:"w-350",placeholder:"请选择",filterable:!0,selectOptions:t.optionsInfo.scenarios,optionLabel:"title",optionValue:"id"}}),t._v(" "),n("scrm-form-item",{attrs:{itemInfo:t.info,itemKey:"title",itemLabel:"任务名称",itemRequired:!0,itemClass:"form_required_after",itemType:"input",subClass:"w-350",maxlength:"20",placeholder:"20个字符以内"}}),t._v(" "),n("scrm-form-item",{attrs:{itemInfo:{},itemLabel:"任务内容",itemRequired:!0,itemClass:"form_required_after",subClass:"w-350"}},[n("template",{slot:"custom"},[n("el-button",{staticClass:"blue_font_white_bg w-60",attrs:{plain:"",round:"",size:"mini"},on:{click:t.addContent}},[n("i",{staticClass:"el-icon-plus"})])],1)],2),t._v(" "),t._l(t.info.content,function(e,i){return n("div",{key:i},[n("scrm-form-item",{attrs:{itemLabel:"任务"+(i+1),itemInfo:e,itemKey:"title",itemType:"input",itemRequired:!0,itemClass:"form_required_after",subClass:"w-350",maxlength:"30",placeholder:"30个字符以内"}},[n("template",{slot:"lineHander"},[n("span",{directives:[{name:"show",rawName:"v-show",value:i!=t.info.content.length-1&&t.info.content.length>1,expression:"index != (info.content.length -1) && info.content.length > 1"}],staticClass:"span-icon icon-down",on:{click:function(e){return t.downBtn(i)}}}),t._v(" "),n("span",{directives:[{name:"show",rawName:"v-show",value:i>0&&t.info.content.length>1,expression:"index > 0 && info.content.length > 1"}],staticClass:"span-icon icon-up",on:{click:function(e){return t.upBtn(i)}}}),t._v(" "),n("span",{directives:[{name:"show",rawName:"v-show",value:i>0&&t.info.content.length>1,expression:"index > 0 && info.content.length > 1"}],staticClass:"span-icon icon-delete",on:{click:function(e){return t.deleteBtn(i)}}})])],2)],1)}),t._v(" "),n("scrm-form-item",{attrs:{itemInfo:t.info,itemKey:"dccGroup",itemLabel:"适用坐席组",itemRequired:!0,itemClass:"form_required_after",itemType:"select",filterable:!0,multiple:"","collapse-tags":"",selectOptions:t.optionsInfo.dccGroup,optionLabel:"title",optionValue:"id",subClass:"w-350",selectIsAll:!0,placeholder:"请选择"},on:{change:t.changeGroup}}),t._v(" "),n("el-form-item",{staticClass:"form_required_after form-task-time",staticStyle:{"margin-bottom":"22px"},attrs:{label:"任务开始时间",required:!0}},[n("el-date-picker",{attrs:{type:"datetime",size:"small",placeholder:"选择日期时间","value-format":"yyyy-MM-dd HH:mm",format:"yyyy-MM-dd HH:mm","default-time":t.defaultStartDate,"picker-options":{disabledDate:function(t){return t<new Date(Date.now()-864e5).getTime()}}},on:{focus:function(e){return t.dataFocus()}},model:{value:t.info.startDate,callback:function(e){t.$set(t.info,"startDate",e)},expression:"info.startDate"}})],1),t._v(" "),n("el-form-item",{staticClass:"form_required_after form-task-time",attrs:{label:"任务结束时间",required:!0}},[n("el-date-picker",{attrs:{type:"datetime",size:"small",placeholder:"选择日期时间","value-format":"yyyy-MM-dd HH:mm",format:"yyyy-MM-dd HH:mm","default-time":"23:59:59",disabled:t.checked,"picker-options":{disabledDate:function(t){return t<new Date(Date.now()-864e5).getTime()}}},model:{value:t.info.endDate,callback:function(e){t.$set(t.info,"endDate",e)},expression:"info.endDate"}})],1),t._v(" "),n("scrm-form-item",{staticClass:"form-task-limit",attrs:{itemInfo:{}}},[n("template",{slot:"custom"},[n("el-checkbox",{on:{change:t.limitTimechange},model:{value:t.checked,callback:function(e){t.checked=e},expression:"checked"}},[t._v("长期有效")])],1)],2)],2),t._v(" "),n("span",{attrs:{slot:"footer"},slot:"footer"},[n("el-button",{staticClass:"w-90",attrs:{round:"",size:"small"},on:{click:t.cancel}},[t._v("取 消")]),t._v(" "),n("el-button",{staticClass:"w-90",attrs:{round:"",size:"small",type:"primary"},on:{click:t.addFn}},[t._v("保 存")]),t._v(" "),n("el-button",{attrs:{round:"",size:"small",type:"primary"},on:{click:function(e){return t.addFn("online")}}},[t._v("保存并上架")])],1)],1)},staticRenderFns:[]};var g=n("VU/8")(b,v,!1,function(t){n("ZYrh"),n("XIDU")},"data-v-8165a5f4",null).exports,w={components:{ScrmFormItem:f.a},props:{id:{type:[String,Number],default:""}},data:function(){return{dialogVisible:!0,checked:!0,loading:!1,viewInfo:{}}},created:function(){this.taskView()},methods:{cancel:function(){this.$emit("close")},taskView:function(){var t=this;this.loading=!0,this.$fetch.callCenter.openTaskView({id:this.id}).then(function(e){t.viewInfo=e.data.data,"永久有效"!=t.viewInfo.endDate&&t.viewInfo.startDate&&(t.viewInfo.endDate=t.viewInfo.startDate+" - "+t.viewInfo.endDate),t.loading=!1}).catch(function(){t.loading=!1})}}},y={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-dialog",{staticClass:"view-talk-task-dialog",attrs:{title:"查看详情",visible:t.dialogVisible,width:"500px",appentToBody:"","close-on-click-modal":!1,"before-close":t.cancel},on:{"update:visible":function(e){t.dialogVisible=e}}},[n("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",attrs:{"label-width":"110px"}},[n("scrm-form-item",{attrs:{itemLabel:"适用场景",itemType:"input",itemInfo:t.viewInfo,itemKey:"scenarioTitle",editable:!1}}),t._v(" "),n("scrm-form-item",{attrs:{itemLabel:"任务名称",itemType:"input",itemInfo:t.viewInfo,itemKey:"title",editable:!1}}),t._v(" "),n("scrm-form-item",{staticClass:"custom-form",attrs:{itemLabel:"任务内容"}}),t._v(" "),t._l(t.viewInfo.content,function(t,e){return n("scrm-form-item",{key:e,staticClass:"custom-form",attrs:{itemLabel:"任务"+(e+1),itemInfo:t,itemKey:"title",itemType:"input",editable:!1}})}),t._v(" "),n("scrm-form-item",{staticClass:"m-t-15",attrs:{itemLabel:"适用坐席组",itemInfo:{},editable:!1}},[n("template",{slot:"notEdit"},t._l(t.viewInfo.dccGroup,function(e,i){return n("el-tag",{key:"tag"+i,attrs:{type:"info",effect:"plain"}},[t._v("\n                   "+t._s(e.title)+"\n                 ")])}),1)],2),t._v(" "),n("scrm-form-item",{attrs:{itemLabel:"任务时间",itemType:"input",itemInfo:t.viewInfo,itemKey:"endDate",editable:!1}})],2)],1)},staticRenderFns:[]};var _=n("VU/8")(w,y,!1,function(t){n("90Ox")},"data-v-b4356344",null).exports,k=n("PdD4"),C={components:{SearchBar:i.a,SearchCol:a.a,DataTable:o.a,AddTalkTask:g,ViewTalkTask:_},mixins:[k.a],data:function(){return{showAdd:!1,showView:!1,currentRow:{}}},created:function(){this.initData(),this.queryData()},methods:{initData:function(){this.initSearch(),this.initTable(),this.openTaskOption()},initSearch:function(){this.search={list:[{type:"input",label:"任务名称",currentVal:""},{type:"input",label:"任务内容",currentVal:""},{type:"select",label:"适用坐席组",currentVal:"",isAll:!0,isAllTitle:"全部",selectOptions:[],optionLabel:"title",optionValue:"id"},{type:"select",label:"状态",currentVal:"",isAll:!0,isAllTitle:"全部",selectOptions:[],optionLabel:"title",optionValue:"id"},{type:"datePicker",label:"任务结束时间",currentVal:""}],name:0,content:1,group:2,state:3,time:4}},openTaskOption:function(){var t=this;this.$fetch.callCenter.openTaskListOptions({}).then(function(e){var n=e.data.data,i=n.dccGroup,a=n.status;t.search.list[t.search.group].selectOptions=t.$hasArrContent(i)?i:[],t.search.list[t.search.state].selectOptions=t.$hasArrContent(a)?a:[]})},initTable:function(){this.dataTable={tr:[{id:"1",label:"操作选项",prop:"caozuo",show:"template",width:"220"},{id:"2",label:"任务ID",prop:"id",tooltip:!0},{id:"3",label:"任务名称",prop:"title",tooltip:!0},{id:"4",label:"任务内容",prop:"contentOverview",show:"template",tooltip:!0,minWidth:"150"},{id:"5",label:"适用坐席组",prop:"dccGroup",show:"template",tooltip:!0,minWidth:"100"},{id:"6",label:"适用场景",prop:"scenarioTitle",tooltip:!0},{id:"7",label:"任务开始时间",prop:"startDate",tooltip:!0,minWidth:"110"},{id:"8",label:"任务结束时间",prop:"endDate",tooltip:!0,minWidth:"110"},{id:"9",label:"状态",prop:"statusTitle",tooltip:!0},{id:"10",label:"更新时间",prop:"updateDate",tooltip:!0,minWidth:"110"}],data:[],page:{totalCount:0,pageSize:20,currentPage:1},hasSelect:!1,hasExpand:!1,hasFirstPagination:!0,showScrollBar:!0,search:{value:"",show:!1,width:"300",placeholder:"请输入任务名称",displayCol:["name","tel"],parma:{id:""}}}},getParams:function(){var t=this.dataTable.page,e=t.currentPage,n=t.pageSize,i=this.search,a=i.name,o=i.content,s=i.group,r=i.state,c=i.time,l=i.list;return{title:l[a].currentVal,content:l[o].currentVal,dccGroup:l[s].currentVal,status:l[r].currentVal,startDate:l[c].currentVal&&l[c].currentVal[0]+" 00:00:00",endDate:l[c].currentVal&&l[c].currentVal[1]+" 23:59:59",pageSize:n,page:e}},queryData:function(){var t=this,e=this,n=this.getParams();this.$fetch.callCenter.openTaskList(n).then(function(n){t.$handleResponse(n,function(t){e.dataTable.data=t.list?t.list:[],e.dataTable.page=t.page?t.page:e.dataTable.page},!0)}).catch(function(){t.$store.commit("closeLoading")})},taskToggle:function(t){var e=this;this.$confirm("您确定要"+(1==t.status?"下":"上")+"架此开口任务吗","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",customClass:"needCenterStyle",cancelButtonClass:"big cancel",confirmButtonClass:"big",roundButton:!0}).then(function(){e.$fetch.callCenter.openTaskToggle({id:t.id}).then(function(n){e.$handleResponse(n,function(n){e.$message.success((1==t.status?"下":"上")+"架成功"),e.queryData()},!0)}).catch(function(){e.$store.commit("closeLoading")})})},deleteTask:function(t){var e=this;this.$confirm("您确定要删除此开口任务吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",customClass:"needCenterStyle",cancelButtonClass:"big cancel",confirmButtonClass:"big",roundButton:!0}).then(function(){e.$fetch.callCenter.openTaskDelete({id:t.id}).then(function(t){e.$handleResponse(t,function(t){e.$message.success("删除成功"),e.queryData()},!0)}).catch(function(){e.$store.commit("closeLoading")})})},viewFn:function(t){this.currentRow=t,this.showView=!0},HandleFn:function(t,e){this.currentRow=e,this.showAdd=!0},closeAddFn:function(t){this.$store.commit("closeLoading"),this.showAdd=!1,"success"==t&&this.queryData()}}},T={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"talk-task-page m-20 common-box"},[n("search-bar",{staticClass:"m-t-10 p-20",attrs:{size:"medium"},on:{clear:t.clear,find:t.find}},[n("div",{staticClass:"search-flex"},[n("search-col",{attrs:{info:t.search.list[t.search.name],placeholder:"请输入"}}),t._v(" "),n("search-col",{attrs:{info:t.search.list[t.search.content],placeholder:"请输入"}}),t._v(" "),n("search-col",{attrs:{info:t.search.list[t.search.group],filterable:""}}),t._v(" "),n("search-col",{attrs:{info:t.search.list[t.search.state]}}),t._v(" "),n("search-col",{attrs:{info:t.search.list[t.search.time],type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"}})],1)]),t._v(" "),n("div",{staticClass:"p-l-r-20 p-b-20"},[n("data-table",{ref:"DataTableRef",attrs:{table:t.dataTable},on:{searchTable:t.searchTable},scopedSlots:t._u([{key:"caozuo",fn:function(e){return[n("el-button",{attrs:{type:"text"},on:{click:function(n){return t.HandleFn("edit",e.obj.row)}}},[t._v("编辑")]),t._v(" "),n("el-button",{staticClass:"btn-split",attrs:{type:"text"},on:{click:function(n){return t.taskToggle(e.obj.row)}}},[t._v(t._s(1==e.obj.row.status?"下架":"上架"))]),t._v(" "),n("el-button",{staticClass:"btn-split red_font",attrs:{type:"text"},on:{click:function(n){return t.deleteTask(e.obj.row)}}},[t._v("删除")]),t._v(" "),n("el-button",{staticClass:"btn-split",attrs:{type:"text"},on:{click:function(n){return t.viewFn(e.obj.row)}}},[t._v("查看详情")])]}},{key:"contentOverview",fn:function(e){return[n("div",{staticClass:"blue pointer",on:{click:function(n){return t.viewFn(e.obj.row)}}},[t._v(t._s(e.obj.row.contentOverview))])]}},{key:"dccGroup",fn:function(e){return[e.obj.row.dccGroup&&e.obj.row.dccGroup.length?n("span",[t._v("\n                    "+t._s(e.obj.row.dccGroup[0].title)+"\n                    "),e.obj.row.dccGroup[1]?n("span",[t._v("、"+t._s(e.obj.row.dccGroup[1].title))]):t._e(),t._v(" "),e.obj.row.dccGroup.length>2?n("span",[t._v("等"+t._s(e.obj.row.dccGroup.length)+"组")]):t._e()]):n("span",[t._v(" --")])]}}])},[n("div",{attrs:{slot:"buttons"},slot:"buttons"},[n("el-button",{attrs:{type:"primary",icon:"el-icon-plus",round:"",size:"small"},on:{click:function(e){return t.HandleFn("add",{})}}},[t._v("新建开口任务")])],1)])],1),t._v(" "),t.showAdd?n("add-talk-task",{attrs:{rowInfo:t.currentRow},on:{close:t.closeAddFn}}):t._e(),t._v(" "),t.showView?n("view-talk-task",{attrs:{id:t.currentRow.id},on:{close:function(e){t.showView=!1}}}):t._e()],1)},staticRenderFns:[]};var D=n("VU/8")(C,T,!1,function(t){n("tnCz")},"data-v-4c85187d",null);e.default=D.exports},tnCz:function(t,e){}});
//# sourceMappingURL=14.2460b61ae1d5f451c65c.js.map